
if switch_turn then
!	add (step_num_down-1)*step_tread+landing_1+landing_dep-(abs(min(standard_x,0))+floor_1+floor_dep),2*step_wid1+handrail_wid,0
	rotz 180
endif

if step_dir=2 then 
!	addy 2*step_wid1+handrail_wid
	mul 1,-1,1
endif

if switch_floor=0 then

	for i=1 to floor_num-1
	addz floor_hei

		if i<floor_num-1 then
			hotspot min(0,standard_x)-floor_1,0,0
			hotspot min(0,standard_x)-floor_1,step_wid1,0
			hotspot min(0,standard_x)-floor_1,0,-floor_thi
			hotspot min(0,standard_x)-floor_1,step_wid1,-floor_thi
		endif

		hotspot min(0,standard_x)-floor_1,step_wid1+handrail_wid,0
		hotspot min(0,standard_x)-floor_1,step_wid1+handrail_wid+step_wid2,0
		hotspot min(0,standard_x)-floor_1,step_wid1+handrail_wid,-floor_thi
		hotspot min(0,standard_x)-floor_1,step_wid1+handrail_wid+step_wid2,-floor_thi
	
		if switch_hr1 then
		
			if i<floor_num-1 then
				hotspot min(0,standard_x)-floor_1,0,hr_hei
				hotspot min(0,standard_x)-floor_1,hr_wid,hr_hei
			endif

			hotspot min(0,standard_x)-floor_1,step_wid1+handrail_wid+step_wid2,hr_hei
			hotspot min(0,standard_x)-floor_1,step_wid1+handrail_wid+step_wid2-hr_wid,hr_hei
		
		endif

	next i
	del floor_num-1

endif


!======================================================================溝
group "step_ditch"

	material m_step

	if step_ditch then

		for j=1 to floor_num-1
		
			for i=1 to step_num_down

				if i=1 then
					tube 5,5,1+2+16+32+64,
					0,-0.002,0,
					-ditch_wid,-0.002,0,
					-ditch_wid,ditch_dep,0,
					0,ditch_dep,0,
					0,-0.002,0,
					-step_nosing,y_down,-step_riser,0,
					0,y_down,0,0,
					-step_nosing,y_down,step_riser-step_rat,0,
					step_tread,y_down,step_riser,0,
					step_tread-step_nosing,y_down,2*step_riser,0
				endif

				if i<step_num_down then
					tube 5,5,1+2+16+32+64,
					0,0.002,0,
					ditch_wid,0.002,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0.002,0,
					-step_tread-step_nosing,y_down,0,0,
					0,y_down,0,0,
					-step_nosing,y_down,step_riser-step_rat,0,
					step_tread,y_down,step_riser,0,
					step_tread-step_nosing,y_down,2*step_riser,0
				endif

				if i=step_num_down then
					tube 5,4,1+2+16+32+64,
					0,0.002,0,
					ditch_wid,0.002,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0.002,0,
					-step_tread-step_nosing,y_down,0,0,
					0,y_down,0,0,
					-step_nosing,y_down,step_riser,0,
					step_tread,y_down,step_riser,0
				endif
		
			add step_tread,0,step_riser
			next i
			del step_num_down

			if landing_ditch=0 then
			
				tube 5,6,1+2+16+32+64,
				0,0.002,0,
				ditch_wid,0.002,0,
				ditch_wid,-ditch_dep,0,
				0,-ditch_dep,0,
				0,0.002,0,
				(step_num_down-1)*step_tread,y_down,(step_num_down-1)*step_riser,0,
				(step_num_down-1)*step_tread-step_nosing,y_down,step_num_down*step_riser,0,
				(step_num_down-1)*step_tread+landing_1,y_down,step_num_down*step_riser,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing-ditch_wid,y_down,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing,y_down,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+2*landing_dep-x_landing,y_down,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0
			
				tube 5,6,1+2+16+32+64,
				0,0.002,0,
				ditch_wid,0.002,0,
				ditch_wid,-ditch_dep,0,
				0,-ditch_dep,0,
				0,0.002,0,
				(step_num_down-1)*step_tread+landing_1+2*landing_dep-x_landing,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing  ,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing-ditch_wid,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser,0,
				(step_num_down-1)*step_tread+landing_1-landing_2,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser,0,
				(step_num_down-1)*step_tread+landing_1-landing_2+step_nosing,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser+step_riser-plus_rat,0
			
			else
			
				tube 5,10,1+2+16+32+64,
				0,0.002,0,
				ditch_wid,0.002,0,
				ditch_wid,-ditch_dep,0,
				0,-ditch_dep,0,
				0,0.002,0,
				(step_num_down-1)*step_tread,y_down,(step_num_down-1)*step_riser,0,
				(step_num_down-1)*step_tread-step_nosing,y_down,step_num_down*step_riser,0,
				(step_num_down-1)*step_tread+landing_1,y_down,step_num_down*step_riser,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing-ditch_wid,y_down,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing,y_down,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing-ditch_wid,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser,0,
				(step_num_down-1)*step_tread+landing_1-landing_2,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser,0,
				(step_num_down-1)*step_tread+landing_1-landing_2+step_nosing,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser+step_riser-plus_rat,0

			endif

			add (step_num_down-1)*step_tread+landing_1-landing_2,0,step_num_down*step_riser
			for i=1 to step_num_up
			
				if i<step_num_up then
					tube 5,5,1+2+16+32+64,
					0,0.002,0,
					ditch_wid,0.002,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0.002,0,
					step_tread+step_nosing,step_wid1+handrail_wid+step_wid2-y_up,0,0,
					0,step_wid1+handrail_wid+step_wid2-y_up,0,0,
					step_nosing,step_wid1+handrail_wid+step_wid2-y_up,step_riser-step_rat,0,
					-step_tread,step_wid1+handrail_wid+step_wid2-y_up,step_riser,0,
					-step_tread+step_nosing,step_wid1+handrail_wid+step_wid2-y_up,2*step_riser,0
				else
					tube 5,4,1+2+16+32+64,
					0,0.002,0,
					ditch_wid,0.002,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0.002,0,
					step_tread+step_nosing,step_wid1+handrail_wid+step_wid2-y_up,0,0,
					0,step_wid1+handrail_wid+step_wid2-y_up,0,0,
					step_nosing,step_wid1+handrail_wid+step_wid2-y_up,step_riser,0,
					-step_tread,step_wid1+handrail_wid+step_wid2-y_up,step_riser,0
				endif
		
			add -step_tread,0,step_riser
			next i
			del step_num_up
			del 1

		addz floor_hei
		next j
		del floor_num-1

		addz (floor_num-2)*floor_hei
		for j=1 to z_1

			if switch_floor=0 or floor_ditch=0 then

				tube 5,6,1+2+16+32+64,
				0,0.002,0,
				ditch_wid,0.002,0,
				ditch_wid,-ditch_dep,0,
				0,-ditch_dep,0,
				0,0.002,0,
				standard_x,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-step_riser,0,
				standard_x+step_nosing   ,step_wid1+handrail_wid+step_wid2-y_up,floor_hei,0,
				min(standard_x,0)-floor_1,step_wid1+handrail_wid+step_wid2-y_up,floor_hei,0,
				min(standard_x,0)-floor_1-floor_dep+x_floor+ditch_wid,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
				min(standard_x,0)-floor_1-floor_dep+x_floor  ,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
				min(standard_x,0)-floor_1-2*floor_dep+x_floor,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0
	
				if j>1 then
				
					tube 5,6,1+2+16+32+64,
					0,0.002,0,
					ditch_wid,0.002,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0.002,0,
					min(standard_x,0)-floor_1-2*floor_dep+x_floor,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor+ditch_wid,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1,y_down,floor_hei,0,
					0,y_down,floor_hei,0,
					-step_nosing,y_down,floor_hei+step_riser-plus_rat,0
				
				else
				
					tube 5,5,1+2+16+32+64,
					0,0.002,0,
					ditch_wid,0.002,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0.002,0,
					min(standard_x,0)-floor_1-2*floor_dep+x_floor,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor+ditch_wid,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-x_floor2,y_down,floor_hei-(x_floor2*floor_rat/100),0,
					min(standard_x,0)-floor_1-x_floor2+(floor_dep-x_floor2),y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0
	
				endif

			else
			
				if j>1 then

					tube 5,10,1+2+16+32+64,
					0,0.002,0,
					ditch_wid,0.002,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0.002,0,
					standard_x,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-step_riser,0,
					standard_x+step_nosing   ,step_wid1+handrail_wid+step_wid2-y_up,floor_hei,0,
					min(standard_x,0)-floor_1,step_wid1+handrail_wid+step_wid2-y_up,floor_hei,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor+ditch_wid,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor+ditch_wid,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1,y_down,floor_hei,0,
					0,y_down,floor_hei,0,
					-step_nosing,y_down,floor_hei+step_riser-plus_rat,0

				else

					tube 5,9,1+2+16+32+64,
					0,0.002,0,
					ditch_wid,0.002,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0.002,0,
					standard_x,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-step_riser,0,
					standard_x+step_nosing   ,step_wid1+handrail_wid+step_wid2-y_up,floor_hei,0,
					min(standard_x,0)-floor_1,step_wid1+handrail_wid+step_wid2-y_up,floor_hei,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor+ditch_wid,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor+ditch_wid,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-x_floor2,y_down,floor_hei-(x_floor2*floor_rat/100),0,
					min(standard_x,0)-floor_1-x_floor2+(floor_dep-x_floor2),y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0

				endif

			endif

		addz -floor_hei
		next j
		del z_1
		del 1

		if switch_gl then

			for i=1 to gl_num

				if i=1 then

					tube 5,4,1+2+16+32+64,
					0,0.002,0,
					ditch_wid,0.002,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0.002,0,
					standard_x-step_tread ,step_wid1+handrail_wid+step_wid2-y_up-ditch_wid,0,0,
					standard_x+step_nosing,step_wid1+handrail_wid+step_wid2-y_up-ditch_wid,0,0,
					standard_x,step_wid1+handrail_wid+step_wid2-y_up-ditch_wid,-step_riser,0,
					standard_x+step_tread,step_wid1+handrail_wid+step_wid2-y_up-ditch_wid,-step_riser,0

				endif

				if i>1 and i<gl_num then

					tube 5,5,1+2+16+32+64,
					0,0.002,0,
					ditch_wid,0.002,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0.002,0,
					standard_x-step_tread+step_nosing,step_wid1+handrail_wid+step_wid2-y_up-ditch_wid,step_riser,0,
					standard_x-step_tread ,step_wid1+handrail_wid+step_wid2-y_up-ditch_wid,0,0,
					standard_x+step_nosing,step_wid1+handrail_wid+step_wid2-y_up-ditch_wid,-step_rat,0,
					standard_x,step_wid1+handrail_wid+step_wid2-y_up-ditch_wid,-step_riser,0,
					standard_x+step_tread,step_wid1+handrail_wid+step_wid2-y_up-ditch_wid,-step_riser,0

				endif

				if i=gl_num then
				
					tube 5,5,1+2+16+32+64,
					0,0.002,0,
					ditch_wid,0.002,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0.002,0,
					standard_x-step_tread+step_nosing,step_wid1+handrail_wid+step_wid2-y_up-ditch_wid,step_riser,0,
					standard_x-step_tread ,step_wid1+handrail_wid+step_wid2-y_up-ditch_wid,0,0,
					standard_x+step_nosing,step_wid1+handrail_wid+step_wid2-y_up-ditch_wid,-step_rat,0,
					standard_x,step_wid1+handrail_wid+step_wid2-y_up-ditch_wid,-step_riser,0,
					standard_x+step_nosing,step_wid1+handrail_wid+step_wid2-y_up-ditch_wid,-step_riser,0
				
				endif

			add step_tread,0,-step_riser
			next i
			del gl_num

		endif

	else

		if landing_ditch then
		
			for j=1 to floor_num-1

				tube 5,4,1+2+16+32+64,
				0,0.002,0,
				ditch_wid,0.002,0,
				ditch_wid,-ditch_dep,0,
				0,-ditch_dep,0,
				0,0.002,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing,y_down-1,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing,y_down,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing,step_wid1+handrail_wid+step_wid2-y_up+1,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0

			addz floor_hei
			next j
			del floor_num-1

		endif
		
		if switch_floor and floor_ditch then
			
			addz (floor_num-2)*floor_hei
			for j=1 to z_1

				tube 5,4,1+2+16+32+64,
				0,0.002,0,
				ditch_wid,0.002,0,
				ditch_wid,-ditch_dep,0,
				0,-ditch_dep,0,
				0,0.002,0,
				min(standard_x,0)-floor_1-floor_dep+x_floor,step_wid1+handrail_wid+step_wid2-y_up+1,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
				min(standard_x,0)-floor_1-floor_dep+x_floor,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
				min(standard_x,0)-floor_1-floor_dep+x_floor,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
				min(standard_x,0)-floor_1-floor_dep+x_floor,y_down-1,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0

			addz -floor_hei
			next j
			del z_1
			del 1


		endif

	endif

endgroup


!======================================================================立上り開口
group "handrail_hide"

	if switch_fin=0 then
		material m_step
	else
		material fin_hr_inside
	endif

	if switch_floor and hr_hide=1 then !フロア踊り場側
		add min(standard_x,0)-floor_1-floor_dep-0.001,hr_wid+hr_hide_start,-gl_num*step_riser
		block hr_wid2+0.002,step_wid1+handrail_wid+step_wid2-2*hr_wid-hr_hide_start-hr_hide_end,gl_num*step_riser+(floor_num-1)*floor_hei+floor_hr_hei+0.001
		del 1
	endif
	
	if hr_hide=2 then !中間踊り場下部階段側
		if switch_floor then
			add min(standard_x,0)-floor_1-floor_dep+hr_wid2+hr_hide_start,-0.001,-gl_num*step_riser
			block floor_dep+floor_1+abs(min(standard_x,0))+(step_num_down-1)*step_tread+landing_1+landing_dep-2*hr_wid2-hr_hide_start-hr_hide_end,hr_wid+0.002,gl_num*step_riser+(floor_num-1)*floor_hei+max_hr_hei+0.001
			del 1
		else
			add min(standard_x,0)-floor_1+hr_hide_start,-0.001,-gl_num*step_riser
			block floor_1+abs(min(standard_x,0))+(step_num_down-1)*step_tread+landing_1+landing_dep-hr_wid2-hr_hide_start-hr_hide_end,hr_wid+0.002,gl_num*step_riser+(floor_num-1)*floor_hei+max_hr_hei+0.001
			del 1
		endif
	endif
	
	if hr_hide=3 then !中間踊り場上部階段側
		if switch_floor then
			add min(standard_x,0)-floor_1-floor_dep+hr_wid2+hr_hide_start,step_wid1+handrail_wid+step_wid2-hr_wid-0.001,-gl_num*step_riser
			block floor_dep+floor_1+abs(min(standard_x,0))+(step_num_down-1)*step_tread+landing_1+landing_dep-2*hr_wid2-hr_hide_start-hr_hide_end,hr_wid+0.002,gl_num*step_riser+(floor_num-1)*floor_hei+max_hr_hei+0.001
			del 1
		else
			add min(standard_x,0)-floor_1+hr_hide_start,step_wid1+handrail_wid+step_wid2-hr_wid-0.001,-gl_num*step_riser
			block floor_1+abs(min(standard_x,0))+(step_num_down-1)*step_tread+landing_1+landing_dep-hr_wid2-hr_hide_start-hr_hide_end,hr_wid+0.002,gl_num*step_riser+(floor_num-1)*floor_hei+max_hr_hei+0.001
			del 1
		endif
	endif

endgroup


group "handrail_hide2"

	material m_step

	if switch_hr1 then

		if switch_floor and hr_hide=1 then !フロア踊り場側
			add min(standard_x,0)-floor_1-floor_dep-0.001,hr_wid+hr_hide_start,-gl_num*step_riser
			block 0.002,step_wid1+handrail_wid+step_wid2-2*hr_wid-hr_hide_start-hr_hide_end,gl_num*step_riser+(floor_num-1)*floor_hei+hr_hei+0.001
			del 1
		endif
		
		if hr_hide=2 then !中間踊り場下部階段側
			if switch_floor then
				add min(standard_x,0)-floor_1-floor_dep+hr_wid2+hr_hide_start,-0.001,-gl_num*step_riser
				block floor_dep+floor_1+abs(min(standard_x,0))+(step_num_down-1)*step_tread+landing_1+landing_dep-2*hr_wid2-hr_hide_start-hr_hide_end,0.002,gl_num*step_riser+(floor_num-1)*floor_hei+hr_hei+0.001
				del 1
			else
				add min(standard_x,0)-floor_1+hr_hide_start,-0.001,-gl_num*step_riser
				block floor_1+abs(min(standard_x,0))+(step_num_down-1)*step_tread+landing_1+landing_dep-hr_wid2-hr_hide_start-hr_hide_end,0.002,gl_num*step_riser+(floor_num-1)*floor_hei+hr_hei+0.001
				del 1
			endif
		endif
		
		if hr_hide=3 then !中間踊り場上部階段側
			if switch_floor then
				add min(standard_x,0)-floor_1-floor_dep+hr_wid2+hr_hide_start,step_wid1+handrail_wid+step_wid2-0.001,-gl_num*step_riser
				block floor_dep+floor_1+abs(min(standard_x,0))+(step_num_down-1)*step_tread+landing_1+landing_dep-2*hr_wid2-hr_hide_start-hr_hide_end,0.002,gl_num*step_riser+(floor_num-1)*floor_hei+hr_hei+0.001
				del 1
			else
				add min(standard_x,0)-floor_1+hr_hide_start,step_wid1+handrail_wid+step_wid2-0.001,-gl_num*step_riser
				block floor_1+abs(min(standard_x,0))+(step_num_down-1)*step_tread+landing_1+landing_dep-hr_wid2-hr_hide_start-hr_hide_end,0.002,gl_num*step_riser+(floor_num-1)*floor_hei+hr_hei+0.001
				del 1
			endif
		endif

	else
	
		add min(standard_x,0)-floor_1-floor_dep-0.001,0,-gl_num*step_riser
		block 0.001,step_wid1+handrail_wid+step_wid2,gl_num*step_riser+(floor_num-1)*floor_hei+hr_hei+0.001
		del 1

		add (step_num_down-1)*step_tread+landing_1+landing_dep-0.001,0,-gl_num*step_riser
		block 0.001,step_wid1+handrail_wid+step_wid2,gl_num*step_riser+(floor_num-1)*floor_hei+hr_hei+0.001
		del 1

		add min(standard_x,0)-floor_1-floor_dep,-0.001,-gl_num*step_riser
		block floor_dep+floor_1+abs(min(standard_x,0))+(step_num_down-1)*step_tread+landing_1+landing_dep,0.001,gl_num*step_riser+(floor_num-1)*floor_hei+hr_hei+0.001
		del 1

		add min(standard_x,0)-floor_1-floor_dep,step_wid1+handrail_wid+step_wid2-0.001,-gl_num*step_riser
		block floor_dep+floor_1+abs(min(standard_x,0))+(step_num_down-1)*step_tread+landing_1+landing_dep,0.001,gl_num*step_riser+(floor_num-1)*floor_hei+hr_hei+0.001
		del 1

	endif

endgroup


!======================================================================フロア踊り場非表示
group "hide_floor_landing"

	material m_step

	if switch_floor=0 then
		add min(0,standard_x)-floor_1-floor_dep-0.002-boarder_wid,-0.001-boarder_wid,-gl_num*step_riser-0.001
		block floor_dep+0.002+boarder_wid,step_wid1+handrail_wid+step_wid2+0.002+2*boarder_wid,gl_num*step_riser+(floor_num-1)*floor_hei+floor_hr_hei+0.002
		del 1
	endif

endgroup


group "hide_floor_landing2"

	material m_step

	if switch_floor=0 then
		add min(0,standard_x)-floor_1-floor_dep-0.001,-0.001,(floor_num-1)*floor_hei-floor_thi
		block floor_dep+0.002,step_wid1+handrail_wid+step_wid2+0.002,floor_thi+floor_hr_hei
		del 1
	endif

endgroup

group "hide_floor_landing3"

	material m_step

	if switch_floor=0 then
		for i=1 to floor_num

			add min(0,standard_x)-floor_1-floor_dep-0.001,-0.001,-floor_thi

			block floor_dep+0.002,step_wid1+handrail_wid+step_wid2+0.002,floor_thi

			addz floor_thi

			ruledsegmented 5,1+2+4+16+32+64,
			0,0,0,0,
			floor_dep+0.002,0,0,0,
			floor_dep+0.002,step_wid1+handrail_wid+step_wid2+0.002,0,0,
			0,step_wid1+handrail_wid+step_wid2+0.002,0,0,
			0,0,0,0,
			-2*step_nosing,0,2*step_riser-2*step_rat,
			floor_dep-2*step_nosing,0,2*step_riser,
			floor_dep-2*step_nosing,step_wid1+handrail_wid+step_wid2+0.002,2*step_riser,
			-2*step_nosing,step_wid1+handrail_wid+step_wid2+0.002,2*step_riser-2*step_rat,
			-2*step_nosing,0,2*step_riser-2*step_rat

			del 2

		addz floor_hei
		next i
		del floor_num
	endif

endgroup


!======================================================================ボーダー
group "boarder"

	if switch_hr1 and switch_boarder then

		material m_boarder
	
		!ホットスポット
		if switch_gl then
			hotspot standard_x+gl_num*step_tread,step_wid1+handrail_wid+step_wid2,hr_hei-gl_num*step_riser
			hotspot standard_x,step_wid1+handrail_wid+step_wid2,hr_hei
			if switch_floor then
				hotspot min(standard_x,0)-floor_1-floor_dep,step_wid1+handrail_wid+step_wid2,hr_hei
				hotspot min(standard_x,0)-floor_1-floor_dep,0,hr_hei
			endif
		endif
		
		for j=1 to floor_num-1
		
			hotspot -step_tread,0,hr_hei
			hotspot (step_num_down-1)*step_tread,0,step_num_down*step_riser+hr_hei
		
			hotspot (step_num_down-1)*step_tread+landing_1+landing_dep,0,step_num_down*step_riser+hr_hei
			hotspot (step_num_down-1)*step_tread+landing_1+landing_dep,step_wid1+handrail_wid+step_wid2,step_num_down*step_riser+hr_hei
		
			hotspot step_num_down*step_tread+landing_1-landing_2,step_wid1+handrail_wid+step_wid2,step_num_down*step_riser+hr_hei
			hotspot standard_x,step_wid1+handrail_wid+step_wid2,floor_hei+hr_hei
		
			if switch_floor then
				hotspot min(standard_x,0)-floor_1-floor_dep,step_wid1+handrail_wid+step_wid2,floor_hei+hr_hei
				hotspot min(standard_x,0)-floor_1-floor_dep,0,floor_hei+hr_hei
			endif
		
		addz floor_hei
		next j
		del floor_num-1
		
		hotspot min(standard_x,0)-floor_1,0,(floor_num-1)*floor_hei+hr_hei
	
		!tubeのパス設定
		if switch_gl then
			put standard_x+2*gl_num*step_tread,step_wid1+handrail_wid+step_wid2,hr_hei,0 !始点の参照点
			put standard_x+gl_num*step_tread,step_wid1+handrail_wid+step_wid2,hr_hei-gl_num*step_riser,0
			put standard_x,step_wid1+handrail_wid+step_wid2,hr_hei,0
			put min(standard_x,0)-floor_1-floor_dep,step_wid1+handrail_wid+step_wid2,hr_hei,0
			put min(standard_x,0)-floor_1-floor_dep,0,hr_hei,0
		else
			put -(step_num_down+1)*step_tread,0,step_num_down*step_riser+hr_hei,0
		endif
	
		for j=1 to floor_num-1
		
			put -step_tread,0,hr_hei+(j-1)*floor_hei,0
			put (step_num_down-1)*step_tread,0,step_num_down*step_riser+hr_hei+(j-1)*floor_hei,0
		
			put (step_num_down-1)*step_tread+landing_1+landing_dep,0,step_num_down*step_riser+hr_hei+(j-1)*floor_hei,0
			put (step_num_down-1)*step_tread+landing_1+landing_dep,step_wid1+handrail_wid+step_wid2,step_num_down*step_riser+hr_hei+(j-1)*floor_hei,0
		
			put step_num_down*step_tread+landing_1-landing_2,step_wid1+handrail_wid+step_wid2,step_num_down*step_riser+hr_hei+(j-1)*floor_hei,0
			put standard_x,step_wid1+handrail_wid+step_wid2,floor_hei+hr_hei+(j-1)*floor_hei,0
		
			put min(standard_x,0)-floor_1-floor_dep,step_wid1+handrail_wid+step_wid2,floor_hei+hr_hei+(j-1)*floor_hei,0
			put min(standard_x,0)-floor_1-floor_dep,0,floor_hei+hr_hei+(j-1)*floor_hei,0
		
		next j
		
		put min(standard_x,0)-floor_1,0,(floor_num-1)*floor_hei+hr_hei,0
		put min(standard_x,0)-floor_1+1,0,(floor_num-1)*floor_hei+hr_hei,0 !終点の参照点
	
		tube 5,8*(floor_num-1)+3+switch_gl*4,1+2+16+32+64,
		boarder_wid,0.001,0,
		-0.001,0.001,0,
		-0.001,-boarder_hei,0,
		boarder_wid,-boarder_hei,0,
		boarder_wid,0.001,0,
		get(nsp)

	endif

endgroup

boarder_1=subgroup("boarder","hide_floor_landing")
boarder_2=subgroup{2}(boarder_1,"handrail_hide",m_boarder,m_boarder,m_boarder)

if switch_hr1 and switch_boarder then
	placegroup boarder_2
endif



!======================================================================RDルーフドレン
group "RD_space"

	if switch_fin then 
		material fin_ditch
	else
		material m_step
	endif

	if landing_rd then
	
		for j=1 to floor_num-1
		
			add (step_num_down-1)*step_tread+landing_1+(landing_dep-0.16-x_landing),step_wid1+handrail_wid/2+landing_rd_y,step_num_down*step_riser-(landing_dep-0.16-x_landing)*landing_rat/100-ditch_dep-0.025
			call "ルーフドレン sub",parameters mark=10021,size=75,c=landing_thi
			del 1
		
		addz floor_hei
		next j
		del floor_num-1
	
	endif

	if switch_floor and floor_rd then

		for j=1 to z_1
		
			add min(standard_x,0)-floor_1-floor_dep+0.16+x_floor,step_wid1+handrail_wid/2+floor_rd_y,(floor_num-1)*floor_hei-(floor_dep-0.16-x_floor)*floor_rat/100-ditch_dep-0.025
			call "ルーフドレン sub",parameters mark=10021,size=75,c=landing_thi
			del 1
		
		addz -floor_hei
		next j
		del z_1

	endif

endgroup


group "RD"

	if switch_fin then 
		material fin_ditch
	else
		material m_step
	endif
	
	if landing_rd then
	
		for j=1 to floor_num-1
		
			add (step_num_down-1)*step_tread+landing_1+(landing_dep-0.16-x_landing),step_wid1+handrail_wid/2+landing_rd_y,step_num_down*step_riser-(landing_dep-0.16-x_landing)*landing_rat/100-ditch_dep-0.03
			call "ルーフドレン sub",parameters mark=1002,size=75,c=landing_thi-(landing_dep-0.16-x_landing)*landing_rat/100-ditch_dep
			del 1
		
		addz floor_hei
		next j
		del floor_num-1
	
	endif

	if switch_floor and floor_rd then

		for j=1 to z_1
		
			add min(standard_x,0)-floor_1-floor_dep+0.16+x_floor,step_wid1+handrail_wid/2+floor_rd_y,(floor_num-1)*floor_hei-(floor_dep-0.16-x_floor)*floor_rat/100-ditch_dep-0.03
			call "ルーフドレン sub",parameters mark=1002,size=75,c=landing_thi-(floor_dep-0.16-x_floor)*floor_rat/100-ditch_dep-0.016
			del 1
		
		addz -floor_hei
		next j
		del z_1

	endif

endgroup

if landing_rd then

	for j=1 to floor_num-1

		hotspot (step_num_down-1)*step_tread+landing_1+(landing_dep-0.16-x_landing),step_wid1+handrail_wid/2,step_num_down*step_riser-(landing_dep-0.16-x_landing)*landing_rat/100-ditch_dep+0.15,code,landing_rd_y,1+128:code=code+1
		hotspot (step_num_down-1)*step_tread+landing_1+(landing_dep-0.16-x_landing),step_wid1+handrail_wid/2-1,step_num_down*step_riser-(landing_dep-0.16-x_landing)*landing_rat/100-ditch_dep+0.15,code,landing_rd_y,3:code=code+1
		hotspot (step_num_down-1)*step_tread+landing_1+(landing_dep-0.16-x_landing),step_wid1+handrail_wid/2+landing_rd_y,step_num_down*step_riser-(landing_dep-0.16-x_landing)*landing_rat/100-ditch_dep+0.15,code,landing_rd_y,2:code=code+1

	addz floor_hei
	next j
	del floor_num-1

endif

if switch_floor and floor_rd then

	for j=1 to z_1

		hotspot min(standard_x,0)-floor_1-floor_dep+0.16+x_floor,step_wid1+handrail_wid/2,(floor_num-1)*floor_hei-(floor_dep-0.16-x_floor)*floor_rat/100-ditch_dep+0.15,code,floor_rd_y,1+128:code=code+1
		hotspot min(standard_x,0)-floor_1-floor_dep+0.16+x_floor,step_wid1+handrail_wid/2-1,(floor_num-1)*floor_hei-(floor_dep-0.16-x_floor)*floor_rat/100-ditch_dep+0.15,code,floor_rd_y,3:code=code+1
		hotspot min(standard_x,0)-floor_1-floor_dep+0.16+x_floor,step_wid1+handrail_wid/2+floor_rd_y,(floor_num-1)*floor_hei-(floor_dep-0.16-x_floor)*floor_rat/100-ditch_dep+0.15,code,floor_rd_y,2:code=code+1

	addz -floor_hei
	next j
	del z_1

endif

placegroup "RD"



!======================================================================下部階段
group "step_down"

	if switch_fin=0 then
		material m_step
	else
		material fin_step_down
	endif

	for j=1 to floor_num-1

		if switch_gl or j>1 then
			ruledsegmented 4,1+2+4+16+32+64,
			0,0,0,0,
			min(standard_x,0)-floor_1,0,0,0,
			min(standard_x,0)-floor_1,0,-floor_thi,0,
			0,0,0,0,
			0,step_wid1,0,
			min(standard_x,0)-floor_1,step_wid1,0,
			min(standard_x,0)-floor_1,step_wid1,-floor_thi,
			0,step_wid1,0
		endif
	
		for i=1 to step_num_down-1
			ruledsegmented 4,1+2+4+16+32+64,
			0,0,0,0,
			step_tread,0,step_riser,0,
			-step_nosing,0,step_riser-step_rat,0,
			0,0,0,0,
			0,step_wid1,0,
			step_tread,step_wid1,step_riser,
			-step_nosing,step_wid1,step_riser-step_rat,
			0,step_wid1,0
	
			add step_tread,0,step_riser
		next i
		del step_num_down-1
	
		ruledsegmented 6,1+2+4+16+32+64,
		(step_num_down-1)*step_tread,0,(step_num_down-1)*step_riser,0,
		(step_num_down-1)*step_tread-step_nosing,0,step_num_down*step_riser-step_rat,0,
		step_num_down*step_tread,0,step_num_down*step_riser,0,
		(step_num_down-1)*step_tread+landing_1,0,step_num_down*step_riser,0,
		(step_num_down-1)*step_tread+landing_1,0,step_num_down*step_riser-landing_thi,0,
		(step_num_down-1)*step_tread,0,(step_num_down-1)*step_riser,0,
		(step_num_down-1)*step_tread,step_wid1,(step_num_down-1)*step_riser,
		(step_num_down-1)*step_tread-step_nosing,step_wid1,step_num_down*step_riser-step_rat,
		step_num_down*step_tread,step_wid1,step_num_down*step_riser,
		(step_num_down-1)*step_tread+landing_1,step_wid1,step_num_down*step_riser,
		(step_num_down-1)*step_tread+landing_1,step_wid1,step_num_down*step_riser-landing_thi,
		(step_num_down-1)*step_tread,step_wid1,(step_num_down-1)*step_riser
	
		hotspot 0,0,0
		hotspot 0,step_wid1,0
		
		hotspot -step_nosing,0,step_riser-step_rat
		hotspot -step_nosing,step_wid1,step_riser-step_rat
		
		hotspot step_num_down*step_tread-step_tread-step_nosing,0,step_num_down*step_riser-step_rat
		hotspot step_num_down*step_tread-step_tread-step_nosing,step_wid1,step_num_down*step_riser-step_rat
	
	addz floor_hei
	next j
	del floor_num-1

endgroup

group "step_yuka_down"

	if switch_fin=0 then
		material m_step
	else
		material fin_step_down
	endif

	for j=1 to floor_num-1

		if switch_gl=0 and j=1 then
			ruledsegmented 6,1+2+4+16+32+64,
			0,0,0,0,
			(step_thi/cos(step_angle))/tan(step_angle),0,0,0,
			(step_riser*step_num_down-landing_thi+step_thi/cos(step_angle))/tan(step_angle),0,step_riser*step_num_down-landing_thi,0,
			(step_num_down-1)*step_tread+landing_1,0,step_num_down*step_riser-landing_thi,0,
			(step_num_down-1)*step_tread,0,(step_num_down-1)*step_riser,0,
			0,0,0,0,
			0,step_wid1,0,
			(step_thi/cos(step_angle))/tan(step_angle),step_wid1,0,
			(step_riser*step_num_down-landing_thi+step_thi/cos(step_angle))/tan(step_angle),step_wid1,step_riser*step_num_down-landing_thi,
			(step_num_down-1)*step_tread+landing_1,step_wid1,step_num_down*step_riser-landing_thi,
			(step_num_down-1)*step_tread,step_wid1,(step_num_down-1)*step_riser,
			0,step_wid1,0
		else	
			ruledsegmented 7,1+2+4+16+32+64,
			0,0,0,0,
			min(standard_x,0)-floor_1,0,-floor_thi,0,
			(step_thi/cos(step_angle)-floor_thi)/tan(step_angle),0,-floor_thi,0,
			(step_riser*step_num_down-landing_thi+step_thi/cos(step_angle))/tan(step_angle),0,step_riser*step_num_down-landing_thi,0,
			(step_num_down-1)*step_tread+landing_1,0,step_num_down*step_riser-landing_thi,0,
			(step_num_down-1)*step_tread,0,(step_num_down-1)*step_riser,0,
			0,0,0,0,
			0,step_wid1,0,
			min(standard_x,0)-floor_1,step_wid1,-floor_thi,
			(step_thi/cos(step_angle)-floor_thi)/tan(step_angle),step_wid1,-floor_thi,
			(step_riser*step_num_down-landing_thi+step_thi/cos(step_angle))/tan(step_angle),step_wid1,step_riser*step_num_down-landing_thi,
			(step_num_down-1)*step_tread+landing_1,step_wid1,step_num_down*step_riser-landing_thi,
			(step_num_down-1)*step_tread,step_wid1,(step_num_down-1)*step_riser,
			0,step_wid1,0
		endif

	addz floor_hei
	next j
	del floor_num-1

endgroup

step_down=addgroup("step_down","step_yuka_down")


!======================================================================中間踊り場
group "landing"

	if switch_fin=0 then
		material m_step
	else
		material fin_step_down
	endif

	for j=1 to floor_num-1
	
		add step_num_down*step_tread-step_tread+landing_1,0,step_num_down*step_riser-landing_thi
		
			ruledsegmented 5,1+2+4+16+64,
			landing_dep,0                               ,0                                      ,0,
			landing_dep,0                               ,landing_thi-landing_dep*landing_rat/100,0,
			landing_dep,step_wid1+handrail_wid+step_wid2,landing_thi-landing_dep*landing_rat/100,0,
			landing_dep,step_wid1+handrail_wid+step_wid2,0                                      ,0,
			landing_dep,0                               ,0                                      ,0,
			0          ,0                               ,0                                      ,
			0          ,0                               ,landing_thi                            ,
			0          ,step_wid1+handrail_wid+step_wid2,landing_thi                            ,
			0          ,step_wid1+handrail_wid+step_wid2,0                                      ,
			0          ,0                               ,0         
		
		hotspot landing_dep,0,0
		hotspot landing_dep,step_wid1+handrail_wid+step_wid2,0

		hotspot landing_dep,0,landing_thi-landing_dep*landing_rat/100
		hotspot landing_dep,step_wid1+handrail_wid+step_wid2,landing_thi-landing_dep*landing_rat/100

		del 1
	
	addz floor_hei
	next j
	del floor_num-1

endgroup

hotspot step_num_down*step_tread-step_tread,step_wid1/2,step_num_down*step_riser,code,landing_1,1+128:code=code+1
hotspot step_num_down*step_tread-step_tread-1,step_wid1/2,step_num_down*step_riser,code,landing_1,3:code=code+1
hotspot step_num_down*step_tread-step_tread+landing_1,step_wid1/2,step_num_down*step_riser,code,landing_1,2:code=code+1

hotspot step_num_down*step_tread+landing_1-step_tread,step_wid1+handrail_wid/2,step_num_down*step_riser,code,landing_dep,1+128:code=code+1
hotspot step_num_down*step_tread+landing_1-step_tread-1,step_wid1+handrail_wid/2,step_num_down*step_riser,code,landing_dep,3:code=code+1
hotspot step_num_down*step_tread+landing_1-step_tread+landing_dep,step_wid1+handrail_wid/2,step_num_down*step_riser-landing_dep*landing_rat/100,code,landing_dep,2:code=code+1

hotspot step_num_down*step_tread-step_tread+landing_1,step_wid1+handrail_wid+step_wid2/2,step_num_down*step_riser,code,landing_2,1+128:code=code+1
hotspot step_num_down*step_tread-step_tread+landing_1+1,step_wid1+handrail_wid+step_wid2/2,step_num_down*step_riser,code,landing_2,3:code=code+1
hotspot step_num_down*step_tread-step_tread+landing_1-landing_2,step_wid1+handrail_wid+step_wid2/2,step_num_down*step_riser,code,landing_2,2:code=code+1


!======================================================================上部階段
group "step_up"

	if switch_fin=0 then
		material m_step
	else
		material fin_step_down
	endif

	for j=1 to floor_num-1
	
		add (step_num_down-1)*step_tread+landing_1-landing_2,step_wid1+handrail_wid,step_num_down*step_riser
	
		ruledsegmented 5,1+2+4+16+32+64,
		0,0,0,0,
		landing_2,0,0,0,
		landing_2,0,-landing_thi,0,
		(landing_thi-step_thi/cos(step_angle))/tan(step_angle),0,-landing_thi,0,
		0,0,0,0,
		0,step_wid2,0,
		landing_2,step_wid2,0,
		landing_2,step_wid2,-landing_thi,
		(landing_thi-step_thi/cos(step_angle))/tan(step_angle),step_wid2,-landing_thi,
		0,step_wid2,0
	
		for i=1 to step_num_up-1
			ruledsegmented 4,1+2+4+16+32+64,
			0,0,0,0,
			-step_tread,0,step_riser,0,
			step_nosing,0,step_riser-step_rat,0,
			0,0,0,0,
			0,step_wid2,0,
			-step_tread,step_wid2,step_riser,
			step_nosing,step_wid2,step_riser-step_rat,
			0,step_wid2,0
	
			add -step_tread,0,step_riser
		next i
		del step_num_up-1
	
		ruledsegmented 6,1+2+4+16+32+64,
		-(step_num_up-1)*step_tread,0,(step_num_up-1)*step_riser,0,
		-(step_num_up-1)*step_tread+step_nosing,0,step_num_up*step_riser-step_rat,0,
		-step_num_up*step_tread,0,step_num_up*step_riser,0,
		-(step_num_up-1)*step_tread-max(standard_x,0)-floor_1,0,step_num_up*step_riser,0,
		-(step_num_up-1)*step_tread-max(standard_x,0)-floor_1,0,step_num_up*step_riser-floor_thi,0,
		-(step_num_up-1)*step_tread,0,(step_num_up-1)*step_riser,0,
		-(step_num_up-1)*step_tread,step_wid2,(step_num_up-1)*step_riser,
		-(step_num_up-1)*step_tread+step_nosing,step_wid2,step_num_up*step_riser-step_rat,
		-step_num_up*step_tread,step_wid2,step_num_up*step_riser,
		-(step_num_up-1)*step_tread-max(standard_x,0)-floor_1,step_wid2,step_num_up*step_riser,
		-(step_num_up-1)*step_tread-max(standard_x,0)-floor_1,step_wid2,step_num_up*step_riser-floor_thi,
		-(step_num_up-1)*step_tread,step_wid2,(step_num_up-1)*step_riser
	
		hotspot 0,0,0
		hotspot 0,step_wid2,0
		
		hotspot step_nosing,0,step_riser-step_rat
		hotspot step_nosing,step_wid2,step_riser-step_rat

		hotspot -(step_num_up-1)*step_tread+step_nosing,0,step_num_up*step_riser-step_rat
		hotspot -(step_num_up-1)*step_tread+step_nosing,step_wid2,step_num_up*step_riser-step_rat

		del 1
	
	addz floor_hei
	next j
	del floor_num-1

endgroup

group "step_yuka_up"

	if switch_fin=0 then
		material m_step
	else
		material fin_step_down
	endif
	
	for j=1 to floor_num-1
	
		add (step_num_down-1)*step_tread+landing_1-landing_2,step_wid1+handrail_wid,step_num_down*step_riser
	
		ruledsegmented 6,1+2+4+16+32+64,
		0,0,0,0,
		-(step_num_up-1)*step_tread,0,(step_num_up-1)*step_riser,0,
		-(step_num_up-1)*step_tread-max(standard_x,0)-floor_1,0,step_num_up*step_riser-floor_thi,0,
		-(step_thi/cos(step_angle)+step_num_up*step_riser-floor_thi)/tan(step_angle),0,step_num_up*step_riser-floor_thi,0,
		(landing_thi-step_thi/cos(step_angle))/tan(step_angle),0,-landing_thi,0,
		0,0,0,0,
		0,step_wid2,0,
		-(step_num_up-1)*step_tread,step_wid2,(step_num_up-1)*step_riser,
		-(step_num_up-1)*step_tread-max(standard_x,0)-floor_1,step_wid2,step_num_up*step_riser-floor_thi,
		-(step_thi/cos(step_angle)+step_num_up*step_riser-floor_thi)/tan(step_angle),step_wid2,step_num_up*step_riser-floor_thi,
		(landing_thi-step_thi/cos(step_angle))/tan(step_angle),step_wid2,-landing_thi,
		0,step_wid2,0
	
		del 1
	
	addz floor_hei
	next j
	del floor_num-1

endgroup

step_up=addgroup("step_up","step_yuka_up")


!======================================================================フロア踊り場
group "floor_landing"

	if switch_fin=0 then
		material m_step
	else
		material fin_step_down
	endif

	add min(standard_x,0)-floor_1-floor_dep,0,(floor_num-1)*floor_hei-floor_thi

	for j=1 to z_1
		ruledsegmented 5,1+2+4+16+64,
		0,0,0,0,
		0,step_wid1+handrail_wid+step_wid2,0,0,
		0,step_wid1+handrail_wid+step_wid2,floor_thi-floor_dep*floor_rat/100,0,
		0,0,floor_thi-floor_dep*floor_rat/100,0,
		0,0,0,0,
		floor_dep,0,0,
		floor_dep,step_wid1+handrail_wid+step_wid2,0,
		floor_dep,step_wid1+handrail_wid+step_wid2,floor_thi,
		floor_dep,0,floor_thi,
		floor_dep,0,0
	
		if switch_floor then
		
			hotspot 0,0,0
			hotspot 0,step_wid1+handrail_wid+step_wid2,0
		
			hotspot 0,0,floor_thi-floor_dep*floor_rat/100
			hotspot 0,step_wid1+handrail_wid+step_wid2,floor_thi-floor_dep*floor_rat/100
			
		endif

		addz -floor_hei
	next j
	del z_1

	del 1

endgroup


!======================================================================1階下がり
group "1f_gl"
	if switch_fin=0 then
		material m_step
	else
		material fin_step_down
	endif

	if switch_gl then

		add standard_x,step_wid1+handrail_wid,-step_riser

		ruledsegmented 6,1+2+4+16+32+64,
		0,0,0,0,
		step_nosing,0,step_riser-step_rat,0,
		-step_tread,0,step_riser,0,
		-max(standard_x,0)-floor_1,0,step_riser,0,
		-max(standard_x,0)-floor_1,0,step_riser-floor_thi,0,
		0,0,0,0,
		0,step_wid2,0,
		step_nosing,step_wid2,step_riser-step_rat,
		-step_tread,step_wid2,step_riser,
		-max(standard_x,0)-floor_1,step_wid2,step_riser,
		-max(standard_x,0)-floor_1,step_wid2,step_riser-floor_thi,
		0,step_wid2,0

		if gl_num>=2 then
			for i=1 to gl_num-1
				ruledsegmented 4,1+2+4+16+32+64,
				0,0,0,0,
				step_tread+step_nosing,0,-step_rat,0,
				step_tread,0,-step_riser,0,
				0,0,0,0,
				0,step_wid2,0,
				step_tread+step_nosing,step_wid2,-step_rat,
				step_tread,step_wid2,-step_riser,
				0,step_wid2,0
	
				add step_tread,0,-step_riser
			next i
			del gl_num-1
		endif

		hotspot step_nosing,0,step_riser-step_rat
		hotspot step_nosing,step_wid2,step_riser-step_rat

		hotspot step_nosing+(gl_num-1)*step_tread,0,step_riser-(gl_num-1)*step_riser-step_rat
		hotspot step_nosing+(gl_num-1)*step_tread,step_wid2,step_riser-(gl_num-1)*step_riser-step_rat

		hotspot (gl_num-1)*step_tread,0,step_riser-gl_num*step_riser
		hotspot (gl_num-1)*step_tread,step_wid2,step_riser-gl_num*step_riser

		del 1

	endif
endgroup


group "1f_gl_yuka"
	if switch_fin=0 then
		material m_step
	else
		material fin_step_down
	endif

	if switch_gl then
		add -floor_1+min(standard_x,0),step_wid1+handrail_wid,-floor_thi
	
		ruledsegmented 6,1+2+4+16+32+64,
		0,0,0,0,
		floor_1+max(standard_x,0),0,floor_thi-step_riser,0,
		floor_1+max(standard_x,0)+(gl_num-1)*step_tread,0,floor_thi-step_riser-(gl_num-1)*step_riser,0,
		floor_1+max(standard_x,0)+(gl_num-1)*step_tread-step_thi/sin(step_angle),0,floor_thi-step_riser-(gl_num-1)*step_riser,0,
		floor_1+max(standard_x,0)+(floor_thi-step_riser-step_thi/cos(step_angle))/tan(step_angle),0,0,0,
		0,0,0,0,
		0,step_wid2,0,
		floor_1+max(standard_x,0),step_wid2,floor_thi-step_riser,
		floor_1+max(standard_x,0)+(gl_num-1)*step_tread,step_wid2,floor_thi-step_riser-(gl_num-1)*step_riser,
		floor_1+max(standard_x,0)+(gl_num-1)*step_tread-step_thi/sin(step_angle),step_wid2,floor_thi-step_riser-(gl_num-1)*step_riser,
		floor_1+max(standard_x,0)+(floor_thi-step_riser-step_thi/cos(step_angle))/tan(step_angle),step_wid2,0,
		0,step_wid2,0
	
		del 1
	endif
endgroup


gl=addgroup("1f_gl","1f_gl_yuka")


step1=addgroup(step_down,"landing")
step2=addgroup(step1,step_up)
step3=addgroup(step2,"floor_landing")
step4=addgroup(step3,gl) !溝なし躯体
step5=subgroup(step4,"step_ditch")
step6=subgroup(step5,"RD_space")
step7=subgroup(step6,"handrail_hide2")
step8=subgroup(step7,"hide_floor_landing")



!======================================================================立上り(外側)
group "handrail_step_1"
	if switch_fin=0 then
		material m_step
	else
		material fin_hr_up
	endif

	for j=1 to floor_num-1

		if switch_hr1 then

			if j=1 and switch_gl=0 then
				ruledsegmented 7,1+2+4+16+32+64,
				-step_tread,0,0,0,
				0,0,0,0,
				(step_num_down-1)*step_tread,0,(step_num_down-1)*step_riser,0,
				(step_num_down-1)*step_tread+(landing_hr_hei-hr_hei)/tan(step_angle),0,(step_num_down-1)*step_riser,0,
				(step_num_down-1)*step_tread+(landing_hr_hei-hr_hei)/tan(step_angle),0,step_num_down*step_riser+landing_hr_hei,0,
				-step_tread,0,hr_hei,0,
				-step_tread,0,0,0,
				-step_tread,hr_wid,0,
				0,hr_wid,0,
				(step_num_down-1)*step_tread,hr_wid,(step_num_down-1)*step_riser,
				(step_num_down-1)*step_tread+(landing_hr_hei-hr_hei)/tan(step_angle),hr_wid,(step_num_down-1)*step_riser,
				(step_num_down-1)*step_tread+(landing_hr_hei-hr_hei)/tan(step_angle),hr_wid,step_num_down*step_riser+landing_hr_hei,
				-step_tread,hr_wid,hr_hei,
				-step_tread,hr_wid,0
			else
				ruledsegmented 6,1+2+4+16+32+64,
				-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),0,-step_riser+(floor_hr_hei-hr_hei),0,
				(step_num_down-1)*step_tread,0,(step_num_down-1)*step_riser,0,
				(step_num_down-1)*step_tread+(landing_hr_hei-hr_hei)/tan(step_angle),0,(step_num_down-1)*step_riser,0,
				(step_num_down-1)*step_tread+(landing_hr_hei-hr_hei)/tan(step_angle),0,step_num_down*step_riser+landing_hr_hei,0,
				-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),0,floor_hr_hei,0,
				-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),0,-step_riser+(floor_hr_hei-hr_hei),0,
				-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),hr_wid,-step_riser+(floor_hr_hei-hr_hei),
				(step_num_down-1)*step_tread,hr_wid,(step_num_down-1)*step_riser,
				(step_num_down-1)*step_tread+(landing_hr_hei-hr_hei)/tan(step_angle),hr_wid,(step_num_down-1)*step_riser,
				(step_num_down-1)*step_tread+(landing_hr_hei-hr_hei)/tan(step_angle),hr_wid,step_num_down*step_riser+landing_hr_hei,
				-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),hr_wid,floor_hr_hei,
				-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),hr_wid,-step_riser+(floor_hr_hei-hr_hei)
			endif

			add (step_num_down-1)*step_tread+landing_1-landing_2,step_wid1+handrail_wid+step_wid2,step_num_down*step_riser
		
			ruledsegmented 6,1+2+4+16+32+64,
			step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),0,(landing_hr_hei-hr_hei)-step_riser,0,
			-(step_num_up-1)*step_tread,0,(step_num_up-1)*step_riser,0,
			-(step_num_up-1)*step_tread-(floor_hr_hei-hr_hei)/tan(step_angle),0,(step_num_up-1)*step_riser,0,
			-(step_num_up-1)*step_tread-(floor_hr_hei-hr_hei)/tan(step_angle),0,step_num_up*step_riser+floor_hr_hei,0,
			step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),0,landing_hr_hei,0,
			step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),0,(landing_hr_hei-hr_hei)-step_riser,0,
			step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),-hr_wid,(landing_hr_hei-hr_hei)-step_riser,
			-(step_num_up-1)*step_tread,-hr_wid,(step_num_up-1)*step_riser,
			-(step_num_up-1)*step_tread-(floor_hr_hei-hr_hei)/tan(step_angle),-hr_wid,(step_num_up-1)*step_riser,
			-(step_num_up-1)*step_tread-(floor_hr_hei-hr_hei)/tan(step_angle),-hr_wid,step_num_up*step_riser+floor_hr_hei,
			step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),-hr_wid,landing_hr_hei,
			step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),-hr_wid,(landing_hr_hei-hr_hei)-step_riser
	
			del 1

		endif
	
	addz floor_hei
	next j
	del floor_num-1
endgroup


group "handrail_landing_1"
	if switch_fin=0 then
		material m_step
	else
		material fin_hr_up
	endif

	for j=1 to floor_num-1

		add (step_num_down-1)*step_tread,0,step_num_down*step_riser-landing_dep*landing_rat/100

		ruledsegmented 7,1+2+4+16+32+64,
		(landing_hr_hei-hr_hei)/tan(step_angle),0,0,0,
		landing_1+landing_dep,0,0,0,
		landing_1+landing_dep,step_wid1+handrail_wid+step_wid2-hr_wid,0,0,
		landing_1+landing_dep-hr_wid2,step_wid1+handrail_wid+step_wid2-hr_wid,0,0,
		landing_1+landing_dep-hr_wid2,hr_wid,0,0,
		(landing_hr_hei-hr_hei)/tan(step_angle),hr_wid,0,0,
		(landing_hr_hei-hr_hei)/tan(step_angle),0,0,0,
		(landing_hr_hei-hr_hei)/tan(step_angle),0,landing_dep*landing_rat/100+landing_hr_hei,
		landing_1+landing_dep,0,landing_dep*landing_rat/100+landing_hr_hei,
		landing_1+landing_dep,step_wid1+handrail_wid+step_wid2-hr_wid,landing_dep*landing_rat/100+landing_hr_hei,
		landing_1+landing_dep-hr_wid2,step_wid1+handrail_wid+step_wid2-hr_wid,landing_dep*landing_rat/100+landing_hr_hei,
		landing_1+landing_dep-hr_wid2,hr_wid,landing_dep*landing_rat/100+landing_hr_hei,
		(landing_hr_hei-hr_hei)/tan(step_angle),hr_wid,landing_dep*landing_rat/100+landing_hr_hei,
		(landing_hr_hei-hr_hei)/tan(step_angle),0,landing_dep*landing_rat/100+landing_hr_hei

		del 1

		add (step_num_down-1)*step_tread+landing_1-landing_2,step_wid1+handrail_wid+step_wid2,step_num_down*step_riser

		ruledsegmented 6,1+2+4+16+32+64,
		step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),0,(landing_hr_hei-hr_hei)-step_riser,0,
		0,0,-landing_dep*landing_rat/100,0,
		landing_2+landing_dep,0,-landing_dep*landing_rat/100,0,
		landing_2+landing_dep,0,landing_hr_hei,0,
		step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),0,landing_hr_hei,0,
		step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),0,(landing_hr_hei-hr_hei)-step_riser,0,
		step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),-hr_wid,(landing_hr_hei-hr_hei)-step_riser,
		0,-hr_wid,-landing_dep*landing_rat/100,
		landing_2+landing_dep,-hr_wid,-landing_dep*landing_rat/100,
		landing_2+landing_dep,-hr_wid,landing_hr_hei,
		step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),-hr_wid,landing_hr_hei,
		step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),-hr_wid,(landing_hr_hei-hr_hei)-step_riser

		del 1

	addz floor_hei
	next j
	del floor_num-1

	for j=1 to floor_num-2+switch_gl

		addz floor_hei-floor_dep*floor_rat/100+(floor_num-3)*floor_hei

		ruledsegmented 7,1+2+4+16+32+64,
		standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2,0,0,
		min(standard_x,0)-floor_1-floor_dep,step_wid1+handrail_wid+step_wid2,0,0,
		min(standard_x,0)-floor_1-floor_dep,hr_wid,0,0,
		min(standard_x,0)-floor_1-floor_dep+hr_wid2,hr_wid,0,0,
		min(standard_x,0)-floor_1-floor_dep+hr_wid2,step_wid1+handrail_wid+step_wid2-hr_wid,0,0,
		standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2-hr_wid,0,0,
		standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2,0,0,
		standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2,floor_dep*floor_rat/100+floor_hr_hei,
		min(standard_x,0)-floor_1-floor_dep,step_wid1+handrail_wid+step_wid2,floor_dep*floor_rat/100+floor_hr_hei,
		min(standard_x,0)-floor_1-floor_dep,hr_wid,floor_dep*floor_rat/100+floor_hr_hei,
		min(standard_x,0)-floor_1-floor_dep+hr_wid2,hr_wid,floor_dep*floor_rat/100+floor_hr_hei,
		min(standard_x,0)-floor_1-floor_dep+hr_wid2,step_wid1+handrail_wid+step_wid2-hr_wid,floor_dep*floor_rat/100+floor_hr_hei,
		standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2-hr_wid,floor_dep*floor_rat/100+floor_hr_hei,
		standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2,floor_dep*floor_rat/100+floor_hr_hei

		del 1
		
		addz (floor_num-2)*floor_hei

		ruledsegmented 6,1+2+4+16+32+64,
		-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),0,-step_riser+(floor_hr_hei-hr_hei),0,
		0,0,0,0,
		min(standard_x,0)-floor_1-floor_dep,0,-floor_dep*floor_rat/100,0,
		min(standard_x,0)-floor_1-floor_dep,0,floor_hr_hei,0,
		-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),0,floor_hr_hei,0,
		-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),0,-step_riser+(floor_hr_hei-hr_hei),0,
		-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),hr_wid,-step_riser+(floor_hr_hei-hr_hei),
		0,hr_wid,0,
		min(standard_x,0)-floor_1-floor_dep,hr_wid,-floor_dep*floor_rat/100,
		min(standard_x,0)-floor_1-floor_dep,hr_wid,floor_hr_hei,
		-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),hr_wid,floor_hr_hei,
		-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),hr_wid,-step_riser+(floor_hr_hei-hr_hei)

		del 1

	addz -floor_hei
	next j
	del floor_num-2+switch_gl

	addz (floor_num-1)*floor_hei-floor_dep*floor_rat/100

	if switch_fin=0 then
		m_top=m_step
		m_side=m_step
	else
		m_top=fin_hr_up
		m_side=fin_hr_inside
	endif

	ruledsegmented{2} m_top,m_step,9,1+2+4+8+16+32+64,0,
	standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2,0,0,m_step,
	min(standard_x,0)-floor_1-floor_dep,step_wid1+handrail_wid+step_wid2,0,0,m_step,
	min(standard_x,0)-floor_1-floor_dep,0,0,0,m_step,
	min(standard_x,0)-floor_1,0,0,0,m_side,
	min(standard_x,0)-floor_1,hr_wid,0,0,m_step,
	min(standard_x,0)-floor_1-floor_dep+hr_wid2,hr_wid,0,0,m_step,
	min(standard_x,0)-floor_1-floor_dep+hr_wid2,step_wid1+handrail_wid+step_wid2-hr_wid,0,0,m_step,
	standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2-hr_wid,0,0,m_step,
	standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2,0,0,m_step,
	standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2,floor_dep*floor_rat/100+floor_hr_hei,
	min(standard_x,0)-floor_1-floor_dep,step_wid1+handrail_wid+step_wid2,floor_dep*floor_rat/100+floor_hr_hei,
	min(standard_x,0)-floor_1-floor_dep,0,floor_dep*floor_rat/100+floor_hr_hei,
	min(standard_x,0)-floor_1,0,floor_dep*floor_rat/100+floor_hr_hei,
	min(standard_x,0)-floor_1,hr_wid,floor_dep*floor_rat/100+floor_hr_hei,
	min(standard_x,0)-floor_1-floor_dep+hr_wid2,hr_wid,floor_dep*floor_rat/100+floor_hr_hei,
	min(standard_x,0)-floor_1-floor_dep+hr_wid2,step_wid1+handrail_wid+step_wid2-hr_wid,floor_dep*floor_rat/100+floor_hr_hei,
	standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2-hr_wid,floor_dep*floor_rat/100+floor_hr_hei,
	standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2,floor_dep*floor_rat/100+floor_hr_hei

	del 1
endgroup


group "handrail_rf"
	addz (floor_num-1)*floor_hei-floor_thi

	if switch_hr1_top then
		if switch_fin=0 then
			m_top=m_step
			m_bottom=m_step
			m_side_1=m_step
			m_side_2=m_step
		else
			m_top=fin_hr_up
			m_bottom=fin_step_down
			m_side_1=fin_hr_inside
			m_side_2=fin_hr_outside
		endif

		ruledsegmented{2} m_top,m_bottom,5,1+2+4+8+16+32+64,0,
		min(standard_x,0)-floor_1,0,0,0,m_side_1,
		min(standard_x,0)-floor_1,step_wid1+switch_hr2*(2-hr2_type)*handrail_wid,0,0,m_step,
		min(standard_x,0)-floor_1+hr_wid,step_wid1+switch_hr2*(2-hr2_type)*handrail_wid,0,0,m_side_2,
		min(standard_x,0)-floor_1+hr_wid,0,0,0,m_side_2,
		min(standard_x,0)-floor_1,0,0,0,m_step,
		min(standard_x,0)-floor_1,0,floor_thi+floor_hr_hei,
		min(standard_x,0)-floor_1,step_wid1+switch_hr2*(2-hr2_type)*handrail_wid,floor_thi+floor_hr_hei,
		min(standard_x,0)-floor_1+hr_wid,step_wid1+switch_hr2*(2-hr2_type)*handrail_wid,floor_thi+floor_hr_hei,
		min(standard_x,0)-floor_1+hr_wid,0,floor_thi+floor_hr_hei,
		min(standard_x,0)-floor_1,0,floor_thi+floor_hr_hei
	endif

	del 1
endgroup
placegroup "handrail_rf"


group "handrail_gl_step_1"
	if switch_fin=0 then
		material m_step
	else
		material fin_hr_up
	endif

	if switch_gl then

		ruledsegmented 7,1+2+4+16+32+64,
		standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2,floor_hr_hei,0,
		standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2,-step_riser,0,
		standard_x,step_wid1+handrail_wid+step_wid2,-step_riser,0,
		standard_x+(gl_num-1)*step_tread,step_wid1+handrail_wid+step_wid2,-gl_num*step_riser,0,
		standard_x+gl_num*step_tread,step_wid1+handrail_wid+step_wid2,-gl_num*step_riser,0,
		standard_x+gl_num*step_tread,step_wid1+handrail_wid+step_wid2,-gl_num*step_riser+hr_hei,0,
		standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2,floor_hr_hei,0,
		standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2-hr_wid,floor_hr_hei,
		standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2-hr_wid,-step_riser,
		standard_x,step_wid1+handrail_wid+step_wid2-hr_wid,-step_riser,
		standard_x+(gl_num-1)*step_tread,step_wid1+handrail_wid+step_wid2-hr_wid,-gl_num*step_riser,
		standard_x+gl_num*step_tread,step_wid1+handrail_wid+step_wid2-hr_wid,-gl_num*step_riser,
		standard_x+gl_num*step_tread,step_wid1+handrail_wid+step_wid2-hr_wid,-gl_num*step_riser+hr_hei,
		standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2-hr_wid,floor_hr_hei

	endif
endgroup

handrail_1_1=addgroup("handrail_step_1","handrail_landing_1")
handrail_1_3=addgroup(handrail_1_1,"handrail_gl_step_1")
handrail_1_4=subgroup(handrail_1_3,step4)
handrail_1_5=subgroup(handrail_1_4,"handrail_hide")
handrail_1_6=subgroup(handrail_1_5,"boarder")


group "handrail_soto"
	if switch_hr1 then
		placegroup handrail_1_6
	endif
endgroup


!======================================================================立上り(内側)
group "handrail_step_2"
	if switch_fin=0 then
		material m_step
	else
		material fin_hr_up
	endif

	for i=1 to floor_num-1

		if min(standard_x,0)-floor_1-hr2_wid<=-step_tread then
			ruledsegmented 6,1+2+4+16+32+64,
			0,step_wid1,0,0,
			(step_num_down-1)*step_tread,step_wid1,(step_num_down-1)*step_riser,0,
			(step_num_down-1)*step_tread,step_wid1,step_num_down*step_riser+hr2_hei,0,
			-step_tread,step_wid1,hr2_hei,0,
			-step_tread,step_wid1,0,0,
			0,step_wid1,0,0,
			0,step_wid1-hr2_wid,0,
			(step_num_down-1)*step_tread,step_wid1-hr2_wid,(step_num_down-1)*step_riser,
			(step_num_down-1)*step_tread,step_wid1-hr2_wid,step_num_down*step_riser+hr2_hei,
			-step_tread,step_wid1-hr2_wid,hr2_hei,
			-step_tread,step_wid1-hr2_wid,0,
			0,step_wid1-hr2_wid,0
		else
			ruledsegmented 6,1+2+4+16+32+64,
			0,step_wid1,0,0,
			(step_num_down-1)*step_tread,step_wid1,(step_num_down-1)*step_riser,0,
			(step_num_down-1)*step_tread,step_wid1,step_num_down*step_riser+hr2_hei,0,
			min(standard_x,0)-floor_1-hr2_wid,step_wid1,tan(step_angle)*(min(standard_x,0)-floor_1-hr2_wid)+step_riser+hr2_hei,0,
			min(standard_x,0)-floor_1-hr2_wid,step_wid1,0,0,
			0,step_wid1,0,0,
			0,step_wid1-hr2_wid,0,
			(step_num_down-1)*step_tread,step_wid1-hr2_wid,(step_num_down-1)*step_riser,
			(step_num_down-1)*step_tread,step_wid1-hr2_wid,step_num_down*step_riser+hr2_hei,
			min(standard_x,0)-floor_1-hr2_wid,step_wid1-hr2_wid,tan(step_angle)*(min(standard_x,0)-floor_1-hr2_wid)+step_riser+hr2_hei,
			min(standard_x,0)-floor_1-hr2_wid,step_wid1-hr2_wid,0,
			0,step_wid1-hr2_wid,0
		endif

		if standard_x+step_num_up*step_tread<=(step_num_down-1)*step_tread+landing_1+hr2_wid then
			ruledsegmented 6,1+2+4+16+32+64,
			standard_x,step_wid1+handrail_wid,floor_hei-step_riser,0,
			standard_x+(step_num_up-1)*step_tread,step_wid1+handrail_wid,floor_hei-step_num_up*step_riser,0,
			standard_x+step_num_up*step_tread,step_wid1+handrail_wid,floor_hei-step_num_up*step_riser,0,
			standard_x+step_num_up*step_tread,step_wid1+handrail_wid,floor_hei-step_num_up*step_riser+hr2_hei,0,
			standard_x,step_wid1+handrail_wid,floor_hei+hr2_hei,0,
			standard_x,step_wid1+handrail_wid,floor_hei-step_riser,0,
			standard_x,step_wid1+handrail_wid+hr2_wid,floor_hei-step_riser,
			standard_x+(step_num_up-1)*step_tread,step_wid1+handrail_wid+hr2_wid,floor_hei-step_num_up*step_riser,
			standard_x+step_num_up*step_tread,step_wid1+handrail_wid+hr2_wid,floor_hei-step_num_up*step_riser,
			standard_x+step_num_up*step_tread,step_wid1+handrail_wid+hr2_wid,floor_hei-step_num_up*step_riser+hr2_hei,
			standard_x,step_wid1+handrail_wid+hr2_wid,floor_hei+hr2_hei,
			standard_x,step_wid1+handrail_wid+hr2_wid,floor_hei-step_riser
		else
			ruledsegmented 6,1+2+4+16+32+64,
			standard_x,step_wid1+handrail_wid,floor_hei-step_riser,0,
			standard_x+(step_num_up-1)*step_tread,step_wid1+handrail_wid,floor_hei-step_num_up*step_riser,0,
			(step_num_down-1)*step_tread+landing_1+hr2_wid,step_wid1+handrail_wid,floor_hei-step_num_up*step_riser,0,
			(step_num_down-1)*step_tread+landing_1+hr2_wid,step_wid1+handrail_wid,floor_hei-step_num_up*step_riser+hr2_hei+(step_tread-landing_2-hr2_wid)*tan(step_angle),0,
			standard_x,step_wid1+handrail_wid,floor_hei+hr2_hei,0,
			standard_x,step_wid1+handrail_wid,floor_hei-step_riser,0,
			standard_x,step_wid1+handrail_wid+hr2_wid,floor_hei-step_riser,
			standard_x+(step_num_up-1)*step_tread,step_wid1+handrail_wid+hr2_wid,floor_hei-step_num_up*step_riser,
			(step_num_down-1)*step_tread+landing_1+hr2_wid,step_wid1+handrail_wid+hr2_wid,floor_hei-step_num_up*step_riser,
			(step_num_down-1)*step_tread+landing_1+hr2_wid,step_wid1+handrail_wid+hr2_wid,floor_hei-step_num_up*step_riser+hr2_hei+(step_tread-landing_2-hr2_wid)*tan(step_angle),
			standard_x,step_wid1+handrail_wid+hr2_wid,floor_hei+hr2_hei,
			standard_x,step_wid1+handrail_wid+hr2_wid,floor_hei-step_riser
		endif

	addz floor_hei
	next i
	del floor_num-1
endgroup

group "handrail_landing_2"
	if switch_fin=0 then
		material m_step
	else
		material fin_hr_up
	endif

	for i=1 to floor_num-1

		ruledsegmented 9,1+2+4+16+32+64,
		(step_num_down-1)*step_tread,step_wid1,step_num_down*step_riser-landing_dep*landing_rat/100,0,
		(step_num_down-1)*step_tread+landing_1,step_wid1,step_num_down*step_riser-landing_dep*landing_rat/100,0,
		(step_num_down-1)*step_tread+landing_1,step_wid1+handrail_wid,step_num_down*step_riser-landing_dep*landing_rat/100,0,
		(step_num_down-1)*step_tread+landing_1-landing_2,step_wid1+handrail_wid,step_num_down*step_riser-landing_dep*landing_rat/100,0,
		(step_num_down-1)*step_tread+landing_1-landing_2,step_wid1+handrail_wid+hr2_wid,step_num_down*step_riser-landing_dep*landing_rat/100,0,
		(step_num_down-1)*step_tread+landing_1+hr2_wid,step_wid1+handrail_wid+hr2_wid,step_num_down*step_riser-landing_dep*landing_rat/100,0,
		(step_num_down-1)*step_tread+landing_1+hr2_wid,step_wid1-hr2_wid,step_num_down*step_riser-landing_dep*landing_rat/100,0,
		(step_num_down-1)*step_tread,step_wid1-hr2_wid,step_num_down*step_riser-landing_dep*landing_rat/100,0,
		(step_num_down-1)*step_tread,step_wid1,step_num_down*step_riser-landing_dep*landing_rat/100,0,
		(step_num_down-1)*step_tread,step_wid1,step_num_down*step_riser+hr2_hei,
		(step_num_down-1)*step_tread+landing_1,step_wid1,step_num_down*step_riser+hr2_hei,
		(step_num_down-1)*step_tread+landing_1,step_wid1+handrail_wid,step_num_down*step_riser+hr2_hei,
		(step_num_down-1)*step_tread+landing_1-landing_2,step_wid1+handrail_wid,step_num_down*step_riser+hr2_hei,
		(step_num_down-1)*step_tread+landing_1-landing_2,step_wid1+handrail_wid+hr2_wid,step_num_down*step_riser+hr2_hei,
		(step_num_down-1)*step_tread+landing_1+hr2_wid,step_wid1+handrail_wid+hr2_wid,step_num_down*step_riser+hr2_hei,
		(step_num_down-1)*step_tread+landing_1+hr2_wid,step_wid1-hr2_wid,step_num_down*step_riser+hr2_hei,
		(step_num_down-1)*step_tread,step_wid1-hr2_wid,step_num_down*step_riser+hr2_hei,
		(step_num_down-1)*step_tread,step_wid1,step_num_down*step_riser+hr2_hei

	addz floor_hei
	next i
	del floor_num-1

	if floor_num>2 then

		for i=1 to floor_num-2
	
			ruledsegmented 9,1+2+4+16+32+64,
			0,step_wid1,floor_hei-floor_dep*floor_rat/100,0,
			min(standard_x,0)-floor_1,step_wid1,floor_hei-floor_dep*floor_rat/100,0,
			min(standard_x,0)-floor_1,step_wid1+handrail_wid,floor_hei-floor_dep*floor_rat/100,0,
			standard_x,step_wid1+handrail_wid,floor_hei-floor_dep*floor_rat/100,0,
			standard_x,step_wid1+handrail_wid+hr2_wid,floor_hei-floor_dep*floor_rat/100,0,
			min(standard_x,0)-floor_1-hr2_wid,step_wid1+handrail_wid+hr2_wid,floor_hei-floor_dep*floor_rat/100,0,
			min(standard_x,0)-floor_1-hr2_wid,step_wid1-hr2_wid,floor_hei-floor_dep*floor_rat/100,0,
			0,step_wid1-hr2_wid,floor_hei-floor_dep*floor_rat/100,0,
			0,step_wid1,floor_hei-floor_dep*floor_rat/100,0,
			0,step_wid1,floor_hei+hr2_hei,
			min(standard_x,0)-floor_1,step_wid1,floor_hei+hr2_hei,
			min(standard_x,0)-floor_1,step_wid1+handrail_wid,floor_hei+hr2_hei,
			standard_x,step_wid1+handrail_wid,floor_hei+hr2_hei,
			standard_x,step_wid1+handrail_wid+hr2_wid,floor_hei+hr2_hei,
			min(standard_x,0)-floor_1-hr2_wid,step_wid1+handrail_wid+hr2_wid,floor_hei+hr2_hei,
			min(standard_x,0)-floor_1-hr2_wid,step_wid1-hr2_wid,floor_hei+hr2_hei,
			0,step_wid1-hr2_wid,floor_hei+hr2_hei,
			0,step_wid1,floor_hei+hr2_hei
	
		addz floor_hei
		next i
		del floor_num-2
	
	endif

	addz (floor_num-2)*floor_hei
	
	if switch_floor then
		if switch_fin=0 then
			m_side_1=m_step
			m_side_2=m_step
		else
			m_side_1=fin_hr_up
			m_side_2=fin_hr_inside
		endif

		temporary_x=max(standard_x-(floor_hr_hei-hr2_hei)/tan(step_angle),min(standard_x,0)-floor_1)
	
		ruledsegmented{2} m_step,m_step,6,1+2+4+16+32+64,0,
		standard_x,step_wid1+handrail_wid,floor_hei-floor_dep*floor_rat/100,0,m_step,
		standard_x,step_wid1+handrail_wid,floor_hei+hr2_hei,0,m_step,
		temporary_x,step_wid1+handrail_wid,floor_hei+hr2_hei+(standard_x-temporary_x)*tan(step_angle),0,m_side_1,
		min(standard_x,0)-floor_1,step_wid1+handrail_wid,floor_hei+hr2_hei+(standard_x-temporary_x)*tan(step_angle),0,m_side_2,
		min(standard_x,0)-floor_1,step_wid1+handrail_wid,floor_hei-floor_dep*floor_rat/100,0,m_step,
		standard_x,step_wid1+handrail_wid,floor_hei-floor_dep*floor_rat/100,0,m_step,
		standard_x,step_wid1+handrail_wid+hr2_wid,floor_hei-floor_dep*floor_rat/100,
		standard_x,step_wid1+handrail_wid+hr2_wid,floor_hei+hr2_hei,
		temporary_x,step_wid1+handrail_wid+hr2_wid,floor_hei+hr2_hei+(standard_x-temporary_x)*tan(step_angle),
		min(standard_x,0)-floor_1,step_wid1+handrail_wid+hr2_wid,floor_hei+hr2_hei+(standard_x-temporary_x)*tan(step_angle),
		min(standard_x,0)-floor_1,step_wid1+handrail_wid+hr2_wid,floor_hei-floor_dep*floor_rat/100,
		standard_x,step_wid1+handrail_wid+hr2_wid,floor_hei-floor_dep*floor_rat/100
		
	else
	
		ruledsegmented 6,1+2+4+16+32+64,
		standard_x,step_wid1+handrail_wid,floor_hei-floor_dep*floor_rat/100,0,
		standard_x,step_wid1+handrail_wid,floor_hei+hr2_hei,0,
		standard_x-(floor_hr_hei-hr2_hei)/tan(step_angle),step_wid1+handrail_wid,floor_hei+floor_hr_hei,0,
		min(standard_x,0)-floor_1,step_wid1+handrail_wid,floor_hei+floor_hr_hei,0,
		min(standard_x,0)-floor_1,step_wid1+handrail_wid,floor_hei-floor_dep*floor_rat/100,0,
		standard_x,step_wid1+handrail_wid,floor_hei-floor_dep*floor_rat/100,0,
		standard_x,step_wid1+handrail_wid+hr2_wid,floor_hei-floor_dep*floor_rat/100,
		standard_x,step_wid1+handrail_wid+hr2_wid,floor_hei+hr2_hei,
		standard_x-(floor_hr_hei-hr2_hei)/tan(step_angle),step_wid1+handrail_wid+hr2_wid,floor_hei+floor_hr_hei,
		min(standard_x,0)-floor_1,step_wid1+handrail_wid+hr2_wid,floor_hei+floor_hr_hei,
		min(standard_x,0)-floor_1,step_wid1+handrail_wid+hr2_wid,floor_hei-floor_dep*floor_rat/100,
		standard_x,step_wid1+handrail_wid+hr2_wid,floor_hei-floor_dep*floor_rat/100

	endif

	del 1
endgroup

group "handrail_gl_landing_2"
	if switch_fin=0 then
		material m_step
	else
		material fin_hr_up
	endif
	
	if switch_gl then
	
		addz -floor_hei
		
		ruledsegmented 9,1+2+4+16+32+64,
		0,step_wid1,floor_hei-floor_dep*floor_rat/100,0,
		min(standard_x,0)-floor_1,step_wid1,floor_hei-floor_dep*floor_rat/100,0,
		min(standard_x,0)-floor_1,step_wid1+handrail_wid,floor_hei-floor_dep*floor_rat/100,0,
		standard_x,step_wid1+handrail_wid,floor_hei-floor_dep*floor_rat/100,0,
		standard_x,step_wid1+handrail_wid+hr2_wid,floor_hei-floor_dep*floor_rat/100,0,
		min(standard_x,0)-floor_1-hr2_wid,step_wid1+handrail_wid+hr2_wid,floor_hei-floor_dep*floor_rat/100,0,
		min(standard_x,0)-floor_1-hr2_wid,step_wid1-hr2_wid,floor_hei-floor_dep*floor_rat/100,0,
		0,step_wid1-hr2_wid,floor_hei-floor_dep*floor_rat/100,0,
		0,step_wid1,floor_hei-floor_dep*floor_rat/100,0,
		0,step_wid1,floor_hei+hr2_hei,
		min(standard_x,0)-floor_1,step_wid1,floor_hei+hr2_hei,
		min(standard_x,0)-floor_1,step_wid1+handrail_wid,floor_hei+hr2_hei,
		standard_x,step_wid1+handrail_wid,floor_hei+hr2_hei,
		standard_x,step_wid1+handrail_wid+hr2_wid,floor_hei+hr2_hei,
		min(standard_x,0)-floor_1-hr2_wid,step_wid1+handrail_wid+hr2_wid,floor_hei+hr2_hei,
		min(standard_x,0)-floor_1-hr2_wid,step_wid1-hr2_wid,floor_hei+hr2_hei,
		0,step_wid1-hr2_wid,floor_hei+hr2_hei,
		0,step_wid1,floor_hei+hr2_hei
		
		del 1

	endif
endgroup

group "handrail_gl_step_2"
	if switch_fin=0 then
		material m_step
	else
		material fin_hr_up
	endif

	if switch_gl then

		addy -step_wid2+hr2_wid

		ruledsegmented 6,1+2+4+16+32+64,
		standard_x,step_wid1+handrail_wid+step_wid2,hr2_hei,0,
		standard_x,step_wid1+handrail_wid+step_wid2,-step_riser,0,
		standard_x+(gl_num-1)*step_tread,step_wid1+handrail_wid+step_wid2,-gl_num*step_riser,0,
		standard_x+gl_num*step_tread,step_wid1+handrail_wid+step_wid2,-gl_num*step_riser,0,
		standard_x+gl_num*step_tread,step_wid1+handrail_wid+step_wid2,-gl_num*step_riser+hr2_hei,0,
		standard_x,step_wid1+handrail_wid+step_wid2,hr2_hei,0,
		standard_x,step_wid1+handrail_wid+step_wid2-hr2_wid,hr2_hei,
		standard_x,step_wid1+handrail_wid+step_wid2-hr2_wid,-step_riser,
		standard_x+(gl_num-1)*step_tread,step_wid1+handrail_wid+step_wid2-hr2_wid,-gl_num*step_riser,
		standard_x+gl_num*step_tread,step_wid1+handrail_wid+step_wid2-hr2_wid,-gl_num*step_riser,
		standard_x+gl_num*step_tread,step_wid1+handrail_wid+step_wid2-hr2_wid,-gl_num*step_riser+hr2_hei,
		standard_x,step_wid1+handrail_wid+step_wid2-hr2_wid,hr2_hei
		
		del 1

	endif
endgroup


handrail_2_1=addgroup("handrail_step_2","handrail_landing_2")
handrail_2_2=addgroup(handrail_2_1,"handrail_gl_landing_2")
handrail_2_3=addgroup(handrail_2_2,"handrail_gl_step_2")
handrail_2_5=subgroup(handrail_2_3,step4)


group "handrail_type2_1"
	if switch_fin=0 then
		material m_step
	else
		material fin_hr_up
	endif

	addy step_wid1

	if switch_gl=0 then
		base_z=0
	else
		base_z=-gl_num*step_riser
	endif

	temporary_x1=min(standard_x+step_num_up*step_tread,(step_num_down-1)*step_tread+landing_1)
	temporary_x2=max(standard_x-(floor_hr_hei-hr2_hei)/tan(step_angle),min(standard_x,0)-floor_1)

	ruledsegmented 7,1+2+4+16+32+64,
	min(standard_x,0)-floor_1,0,base_z,0,
	(step_num_down-1)*step_tread+landing_1,0,base_z,0,
	(step_num_down-1)*step_tread+landing_1,0,(floor_num-1)*floor_hei+hr2_hei-step_num_up*step_riser,0,
	temporary_x1,0,(floor_num-1)*floor_hei+hr2_hei-(temporary_x1-standard_x)*tan(step_angle),0,
	temporary_x2,0,(floor_num-1)*floor_hei+hr2_hei-(temporary_x2-standard_x)*tan(step_angle),0,
	min(standard_x,0)-floor_1,0,(floor_num-1)*floor_hei+hr2_hei-(temporary_x2-standard_x)*tan(step_angle),0,
	min(standard_x,0)-floor_1,0,base_z,0,
	min(standard_x,0)-floor_1,handrail_wid,base_z,
	(step_num_down-1)*step_tread+landing_1,handrail_wid,base_z,
	(step_num_down-1)*step_tread+landing_1,handrail_wid,(floor_num-1)*floor_hei+hr2_hei-step_num_up*step_riser,
	temporary_x1,handrail_wid,(floor_num-1)*floor_hei+hr2_hei-(temporary_x1-standard_x)*tan(step_angle),
	temporary_x2,handrail_wid,(floor_num-1)*floor_hei+hr2_hei-(temporary_x2-standard_x)*tan(step_angle),
	min(standard_x,0)-floor_1,handrail_wid,(floor_num-1)*floor_hei+hr2_hei-(temporary_x2-standard_x)*tan(step_angle),
	min(standard_x,0)-floor_1,handrail_wid,base_z

	del 1
endgroup

handrail_type2_2=subgroup("handrail_type2_1",step4)

group "handrail_uchi"
	if switch_hr2 then
		if hr2_type=1 then
			placegroup handrail_2_5
		else
			placegroup handrail_type2_2
		endif
	endif
endgroup

handrail_soto=subgroup("handrail_soto","hide_floor_landing")
handrail_uchi=subgroup("handrail_uchi","hide_floor_landing2")
handrail1=addgroup(handrail_soto,handrail_uchi)
handrail2=subgroup(handrail1,"handrail_hide2")
placegroup handrail2



!=============================================================================手すり
group "handrail_b"

	material m_hrb
	
	if switch_hrb1 then !外側

		for i=1 to floor_num-1
		
			add 0,y_down,step_riser+hrb_hei
			roty -step_angle
			addz -hrb_thi
			block (step_num_down-1)*sqr(step_tread^2+step_riser^2),hrb_wid,hrb_thi
			del 3
	
			add standard_x,step_wid1+handrail_wid+step_wid2-hrb_wid-y_up,floor_hei+hrb_hei
			roty step_angle
			addz -hrb_thi
			block (step_num_up-1)*sqr(step_tread^2+step_riser^2),hrb_wid,hrb_thi
			del 3
	
		addz floor_hei
		next i
		del floor_num-1
	
		if switch_gl then
		
			add standard_x,step_wid1+handrail_wid+step_wid2-hrb_wid-y_up,hrb_hei
			roty step_angle
			addz -hrb_thi
			block (gl_num-1)*sqr(step_tread^2+step_riser^2),hrb_wid,hrb_thi
			del 3
	
		endif
	
	endif

	if switch_hrb2 then !内側
	
		if switch_hr2=0 or hr2_type=2 then
			n=0
		else
			n=hr_wid
		endif

		if switch_hr2=0 or hr2_type=3 then
			nn=0
		else
			nn=hr_wid
		endif

		for i=1 to floor_num-1
		
			add 0,step_wid1-hrb_wid-n,step_riser+hrb_hei
			roty -step_angle
			addz -hrb_thi
			block (step_num_down-1)*sqr(step_tread^2+step_riser^2),hrb_wid,hrb_thi
			del 3
	
			add standard_x,step_wid1+handrail_wid+nn,floor_hei+hrb_hei
			roty step_angle
			addz -hrb_thi
			block (step_num_up-1)*sqr(step_tread^2+step_riser^2),hrb_wid,hrb_thi
			del 3
	
		addz floor_hei
		next i
		del floor_num-1

		if switch_gl then
		
			add standard_x,step_wid1+handrail_wid+nn,hrb_hei
			roty step_angle
			addz -hrb_thi
			block (gl_num-1)*sqr(step_tread^2+step_riser^2),hrb_wid,hrb_thi
			del 3
	
		endif

	endif

endgroup

if switch_hrb1 or switch_hrb2 then placegroup "handrail_b"



!==============================================================================仕上げ
group "fin_step"
	if switch_fin then
		if step_fin_type=1 then
			for j=1 to floor_num-1
				material fin_tread
		
				for i=1 to step_num_down
		
					ruledsegmented 5,1+2+4+16+32+64,	
					0,0,step_riser-step_rat*step_tread/(step_tread+step_nosing),0,
					0,step_wid1,step_riser-step_rat*step_tread/(step_tread+step_nosing),0,
					step_tread,step_wid1,step_riser,0,
					step_tread,0,step_riser,0,
					0,0,step_riser-step_rat*step_tread/(step_tread+step_nosing),0,
					0,0,step_riser-step_rat*step_tread/(step_tread+step_nosing)+0.001,
					0,step_wid1,step_riser-step_rat*step_tread/(step_tread+step_nosing)+0.001,
					step_tread,step_wid1,step_riser+0.001,
					step_tread,0,step_riser+0.001,
					0,0,step_riser-step_rat*step_tread/(step_tread+step_nosing)+0.001
		
				add step_tread,0,step_riser
				next i
				del step_num_down
		
				for i=1 to step_num_up
				add step_tread,0,-step_riser
		
					add standard_x-step_tread,step_wid1+handrail_wid,floor_hei
		
						ruledsegmented 5,1+2+4+16+32+64,
						0,0,step_riser-step_rat*step_tread/(step_tread+step_nosing),0,
						0,step_wid2,step_riser-step_rat*step_tread/(step_tread+step_nosing),0,
						-step_tread,step_wid2,step_riser,0,
						-step_tread,0,step_riser,0,
						0,0,step_riser-step_rat*step_tread/(step_tread+step_nosing),0,
						0,0,step_riser-step_rat*step_tread/(step_tread+step_nosing)+0.001,
						0,step_wid2,step_riser-step_rat*step_tread/(step_tread+step_nosing)+0.001,
						-step_tread,step_wid2,step_riser+0.001,
						-step_tread,0,step_riser+0.001,
						0,0,step_riser-step_rat*step_tread/(step_tread+step_nosing)+0.001
		
					del 1
		
				next i
				del step_num_up
		
				material fin_riser
				
				for i=1 to step_num_down
		
					ruledsegmented 5,1+2+4+16+32+64,
					0,0,0,0,
					0,step_wid1,0,0,
					-0.001,step_wid1,0,0,
					-0.001,0,0,0,
					0,0,0,0,
					-step_nosing,0,step_riser-step_rat,
					-step_nosing,step_wid1,step_riser-step_rat,
					-step_nosing-0.001,step_wid1,step_riser-step_rat,
					-step_nosing-0.001,0,step_riser-step_rat,
					-step_nosing,0,step_riser-step_rat
		
				add step_tread,0,step_riser
				next i
				del step_num_down
		
				for i=1 to step_num_up
		
					add standard_x,step_wid1+handrail_wid,floor_hei-step_riser
					ruledsegmented 5,1+2+4+16+32+64,
					0,0,0,0,
					0,step_wid2,0,0,
					0.001,step_wid2,0,0,
					0.001,0,0,0,
					0,0,0,0,
					step_nosing,0,step_riser-step_rat,
					step_nosing,step_wid2,step_riser-step_rat,
					step_nosing+0.001,step_wid2,step_riser-step_rat,
					step_nosing+0.001,0,step_riser-step_rat,
					step_nosing,0,step_riser-step_rat
					del 1
		
				add step_tread,0,-step_riser
				next i
				del step_num_up
		
				material fin_nosing
		
				if step_nosing>0 then
		
				for i=1 to step_num_down
		
					add -step_nosing,0,step_riser
		
						ruledsegmented 5,1+2+4+16+32+64,
						0,0,-step_rat,0,
						0,step_wid1,-step_rat,0,
						step_nosing,step_wid1,-step_rat*step_tread/(step_tread+step_nosing),0,
						step_nosing,0,-step_rat*step_tread/(step_tread+step_nosing),0,
						0,0,-step_rat,0,
						0,0,-step_rat+0.001,
						0,step_wid1,-step_rat+0.001,
						step_nosing,step_wid1,-step_rat*step_tread/(step_tread+step_nosing)+0.001,
						step_nosing,0,-step_rat*step_tread/(step_tread+step_nosing)+0.001,
						0,0,-step_rat+0.001
		
					del 1
			
				add step_tread,0,step_riser
				next i
				del step_num_down
		
				for i=1 to step_num_up
		
					add standard_x+step_nosing,step_wid1+handrail_wid,floor_hei
		
						ruledsegmented 5,1+2+4+16+32+64,
						0,0,-step_rat,0,
						0,step_wid2,-step_rat,0,
						-step_nosing,step_wid2,-step_rat+step_rat*step_nosing/(step_tread+step_nosing),0,
						-step_nosing,0,-step_rat+step_rat*step_nosing/(step_tread+step_nosing),0,
						0,0,-step_rat,0,
						0,0,-step_rat+0.001,
						0,step_wid2,-step_rat+0.001,
						-step_nosing,step_wid2,-step_rat+step_rat*step_nosing/(step_tread+step_nosing)+0.001,
						-step_nosing,0,-step_rat+step_rat*step_nosing/(step_tread+step_nosing)+0.001,
						0,0,-step_rat+0.001
		
					del 1
			
				add step_tread,0,-step_riser
				next i
				del step_num_up
		
				endif
		
			addz floor_hei
			next j
			del floor_num-1
		
			if switch_gl then
		
				material fin_tread
		
				if gl_num>1 then	
					for i=1 to gl_num
				
						add standard_x-step_tread,step_wid1+handrail_wid,0
		
							ruledsegmented 5,1+2+4+16+32+64,
							0,0,0,0,
							0,step_wid2,0,0,
							step_tread,step_wid2,-step_rat*step_tread/(step_tread+step_nosing),0,
							step_tread,0,-step_rat*step_tread/(step_tread+step_nosing),0,
							0,0,0,0,
							0,0,0.001,
							0,step_wid2,0.001,
							step_tread,step_wid2,-step_rat*step_tread/(step_tread+step_nosing)+0.001,
							step_tread,0,-step_rat*step_tread/(step_tread+step_nosing)+0.001,
							0,0,0.001
		
						del 1
		
					add step_tread,0,-step_riser
					next i
					del gl_num
				endif
		
				material fin_riser
		
				for i=1 to gl_num
		
					add standard_x,step_wid1+handrail_wid,-step_riser
		
						ruledsegmented 5,1+2+4+16+32+64,
						0,0,0,0,
						0,step_wid2,0,0,
						0.001,step_wid2,0,0,
						0.001,0,0,0,
						0,0,0,0,
						step_nosing,0,step_riser-step_rat,
						step_nosing,step_wid2,step_riser-step_rat,
						step_nosing+0.001,step_wid2,step_riser-step_rat,
						step_nosing+0.001,0,step_riser-step_rat,
						step_nosing,0,step_riser-step_rat
		
					del 1
		
				add step_tread,0,-step_riser
				next i
				del gl_num
		
				material fin_nosing
		
				if step_nosing>0 then
		
				for i=1 to gl_num
		
					add standard_x,step_wid1+handrail_wid,0
		
						ruledsegmented 5,1+2+4+16+32+64,
						0,0,-step_rat*step_tread/(step_tread+step_nosing),0,
						0,step_wid2,-step_rat*step_tread/(step_tread+step_nosing),0,
						step_nosing,step_wid2,-step_rat,0,
						step_nosing,0,-step_rat,0,
						0,0,-step_rat*step_tread/(step_tread+step_nosing),0,
						0,0,-step_rat*step_tread/(step_tread+step_nosing)+0.001,
						0,step_wid2,-step_rat*step_tread/(step_tread+step_nosing)+0.001,
						step_nosing,step_wid2,-step_rat+0.001,
						step_nosing,0,-step_rat+0.001,
						0,0,-step_rat*step_tread/(step_tread+step_nosing)+0.001
		
					del 1
			
				add step_tread,0,-step_riser
				next i
				del gl_num
		
				endif
			endif
		else
			for j=1 to floor_num-1
				material fin_mortar
		
				for i=1 to step_num_down
					if i<step_num_down then
						ruledsegmented 9,1+2+4+16+32+64,
						0,0,0,0,
						-step_nosing,0,step_riser-step_rat,0,
						step_tread,0,step_riser,0,
						step_tread+mortar_thi,0,step_riser,0,
						step_tread+mortar_thi,0,step_riser-mortar_thi,0,
						step_tread,0,step_riser-mortar_thi,0,
						-step_nosing+mortar_thi,0,step_riser-step_rat-mortar_thi,0,
						mortar_thi,0,0,0,
						0,0,0,0,
						0,step_wid1,0,
						-step_nosing,step_wid1,step_riser-step_rat,
						step_tread,step_wid1,step_riser,
						step_tread+mortar_thi,step_wid1,step_riser,
						step_tread+mortar_thi,step_wid1,step_riser-mortar_thi,
						step_tread,step_wid1,step_riser-mortar_thi,
						-step_nosing+mortar_thi,step_wid1,step_riser-step_rat-mortar_thi,
						mortar_thi,step_wid1,0,
						0,step_wid1,0
					else
						ruledsegmented 7,1+2+4+16+32+64,
						0,0,0,0,
						-step_nosing,0,step_riser-step_rat,0,
						step_tread,0,step_riser,0,
						step_tread,0,step_riser-mortar_thi,0,
						-step_nosing+mortar_thi,0,step_riser-step_rat-mortar_thi,0,
						mortar_thi,0,0,0,
						0,0,0,0,
						0,step_wid1,0,
						-step_nosing,step_wid1,step_riser-step_rat,
						step_tread,step_wid1,step_riser,
						step_tread,step_wid1,step_riser-mortar_thi,
						-step_nosing+mortar_thi,step_wid1,step_riser-step_rat-mortar_thi,
						mortar_thi,step_wid1,0,
						0,step_wid1,0
					endif
				add step_tread,0,step_riser
				next i
				del step_num_down
		
				for i=1 to step_num_up
				add step_tread,0,-step_riser
		
					add standard_x-step_tread,step_wid1+handrail_wid,floor_hei
						if i=1 then
							ruledsegmented 7,1+2+4+16+32+64,
							0,0,0,0,
							step_nosing,0,step_riser-step_rat,0,
							-step_tread,0,step_riser,0,
							-step_tread,0,step_riser-mortar_thi,0,
							step_nosing-mortar_thi,0,step_riser-step_rat-mortar_thi,0,
							-mortar_thi,0,0,0,
							0,0,0,0,
							0,step_wid2,0,
							step_nosing,step_wid2,step_riser-step_rat,
							-step_tread,step_wid2,step_riser,
							-step_tread,step_wid2,step_riser-mortar_thi,
							step_nosing-mortar_thi,step_wid2,step_riser-step_rat-mortar_thi,
							-mortar_thi,step_wid2,0,
							0,step_wid2,0
						else
							ruledsegmented 9,1+2+4+16+32+64,
							0,0,0,0,
							step_nosing,0,step_riser-step_rat,0,
							-step_tread,0,step_riser,0,
							-step_tread-mortar_thi,0,step_riser,0,
							-step_tread-mortar_thi,0,step_riser-mortar_thi,0,
							-step_tread,0,step_riser-mortar_thi,0,
							step_nosing-mortar_thi,0,step_riser-step_rat-mortar_thi,0,
							-mortar_thi,0,0,0,
							0,0,0,0,
							0,step_wid2,0,
							step_nosing,step_wid2,step_riser-step_rat,
							-step_tread,step_wid2,step_riser,
							-step_tread-mortar_thi,step_wid2,step_riser,
							-step_tread-mortar_thi,step_wid2,step_riser-mortar_thi,
							-step_tread,step_wid2,step_riser-mortar_thi,
							step_nosing-mortar_thi,step_wid2,step_riser-step_rat-mortar_thi,
							-mortar_thi,step_wid2,0,
							0,step_wid2,0
						endif
					del 1
		
				next i
				del step_num_up
		
			addz floor_hei
			next j
			del floor_num-1
		
			if switch_gl then
				material fin_mortar
		
				if gl_num>1 then	
					for i=1 to gl_num
				
						add standard_x,step_wid1+handrail_wid,-step_riser
		
						if i=1 then
							ruledsegmented 7,1+2+4+16+32+64,
							0,0,0,0,
							step_nosing,0,step_riser-step_rat,0,
							-step_tread,0,step_riser,0,
							-step_tread,0,step_riser-mortar_thi,0,
							step_nosing-mortar_thi,0,step_riser-step_rat-mortar_thi,0,
							-mortar_thi,0,0,0,
							0,0,0,0,
							0,step_wid2,0,
							step_nosing,step_wid2,step_riser-step_rat,
							-step_tread,step_wid2,step_riser,
							-step_tread,step_wid2,step_riser-mortar_thi,
							step_nosing-mortar_thi,step_wid2,step_riser-step_rat-mortar_thi,
							-mortar_thi,step_wid2,0,
							0,step_wid2,0
						else
							ruledsegmented 9,1+2+4+16+32+64,
							0,0,0,0,
							step_nosing,0,step_riser-step_rat,0,
							-step_tread,0,step_riser,0,
							-step_tread-mortar_thi,0,step_riser,0,
							-step_tread-mortar_thi,0,step_riser-mortar_thi,0,
							-step_tread,0,step_riser-mortar_thi,0,
							step_nosing-mortar_thi,0,step_riser-step_rat-mortar_thi,0,
							-mortar_thi,0,0,0,
							0,0,0,0,
							0,step_wid2,0,
							step_nosing,step_wid2,step_riser-step_rat,
							-step_tread,step_wid2,step_riser,
							-step_tread-mortar_thi,step_wid2,step_riser,
							-step_tread-mortar_thi,step_wid2,step_riser-mortar_thi,
							-step_tread,step_wid2,step_riser-mortar_thi,
							step_nosing-mortar_thi,step_wid2,step_riser-step_rat-mortar_thi,
							-mortar_thi,step_wid2,0,
							0,step_wid2,0
						endif
		
						del 1
		
					add step_tread,0,-step_riser
					next i
					del gl_num
				endif
			endif
		endif
	endif
endgroup

fin_step_1=subgroup("fin_step",handrail1)
fin_step_2=subgroup(fin_step_1,"step_ditch")

step9=subgroup(step8,"fin_step")
placegroup step9

group "fin_landing"
	if switch_fin then
		material fin_landing
	
		for i=1 to floor_num-1
		
			add (step_num_down-1)*step_tread,0,step_num_down*step_riser
		
				ruledsegmented 5,1+2+4+8+16+32+64,
				step_tread,0,0,0,
				landing_1,0,0,0,
				landing_1,0,0.001,0,
				step_tread,0,0.001,0,
				step_tread,0,0,0,
				step_tread,step_wid1,0,
				landing_1,step_wid1,0,
				landing_1,step_wid1,0.001,
				step_tread,step_wid1,0.001,
				step_tread,step_wid1,0

				ruledsegmented 5,1+2+4+16+32+64,
				landing_1,step_wid1+handrail_wid+step_wid2,0,0,
				landing_1-landing_2,step_wid1+handrail_wid+step_wid2,0,0,
				landing_1-landing_2,step_wid1+handrail_wid,0,0,
				landing_1,step_wid1+handrail_wid,0,0,
				landing_1,step_wid1+handrail_wid+step_wid2,0,0,
				landing_1,step_wid1+handrail_wid+step_wid2,0.001,
				landing_1-landing_2,step_wid1+handrail_wid+step_wid2,0.001,
				landing_1-landing_2,step_wid1+handrail_wid,0.001,
				landing_1,step_wid1+handrail_wid,0.001,
				landing_1,step_wid1+handrail_wid+step_wid2,0.001
		
				ruledsegmented 5,1+2+4+16+32+64,
				landing_1,0,0,0,
				landing_1+landing_dep,0,-landing_dep*landing_rat/100,0,
				landing_1+landing_dep,step_wid1+handrail_wid+step_wid2,-landing_dep*landing_rat/100,0,
				landing_1,step_wid1+handrail_wid+step_wid2,0,0,
				landing_1,0,0,0,
				landing_1,0,0.001,
				landing_1+landing_dep,0,-landing_dep*landing_rat/100+0.001,
				landing_1+landing_dep,step_wid1+handrail_wid+step_wid2,-landing_dep*landing_rat/100+0.001,
				landing_1,step_wid1+handrail_wid+step_wid2,0.001,
				landing_1,0,0.001
		
			del 1
		
		addz floor_hei
		next i
		del floor_num-1

		if switch_gl=0 then
			floor_landing_num=floor_num-2
		else
			floor_landing_num=floor_num-1
		endif

		if floor_landing_num>0 then
		
			for i=1 to floor_landing_num
			
				addz (floor_num-2)*floor_hei

					ruledsegmented 5,1+2+4+16+32+64,
					0,0,0,0,
					min(standard_x,0)-floor_1,0,0,0,
					min(standard_x,0)-floor_1,step_wid1,0,0,
					0,step_wid1,0,0,
					0,0,0,0,
					0,0,0.001,
					min(standard_x,0)-floor_1,0,0.001,
					min(standard_x,0)-floor_1,step_wid1,0.001,
					0,step_wid1,0.001,
					0,0,0.001

				del 1

			addz -floor_hei
			next i
			del floor_landing_num

		endif

		for i=1 to floor_landing_num+1
		
			addz (floor_num-1)*floor_hei

				ruledsegmented 5,1+2+4+16+32+64,
				min(standard_x,0)-floor_1,0,0,0,
				min(standard_x,0)-floor_1-floor_dep,0,-floor_dep*floor_rat/100,0,
				min(standard_x,0)-floor_1-floor_dep,step_wid1+handrail_wid+step_wid2,-floor_dep*floor_rat/100,0,
				min(standard_x,0)-floor_1,step_wid1+handrail_wid+step_wid2,0,0,
				min(standard_x,0)-floor_1,0,0,0,
				min(standard_x,0)-floor_1,0,0.001,
				min(standard_x,0)-floor_1-floor_dep,0,-floor_dep*floor_rat/100+0.001,
				min(standard_x,0)-floor_1-floor_dep,step_wid1+handrail_wid+step_wid2,-floor_dep*floor_rat/100+0.001,
				min(standard_x,0)-floor_1,step_wid1+handrail_wid+step_wid2,0.001,
				min(standard_x,0)-floor_1,0,0.001

			del 1

		addz -floor_hei
		next i
		del floor_landing_num+1

		for i=1 to floor_landing_num+1
		
			addz (floor_num-1)*floor_hei

				ruledsegmented 5,1+2+4+16+32+64,
				standard_x-step_tread,step_wid1+handrail_wid,0,0,
				min(standard_x,0)-floor_1,step_wid1+handrail_wid,0,0,
				min(standard_x,0)-floor_1,step_wid1+handrail_wid,0.001,0,
				standard_x-step_tread,step_wid1+handrail_wid,0.001,0,
				standard_x-step_tread,step_wid1+handrail_wid,0,0,
				standard_x-step_tread,step_wid1+handrail_wid+step_wid2,0,
				min(standard_x,0)-floor_1,step_wid1+handrail_wid+step_wid2,0,
				min(standard_x,0)-floor_1,step_wid1+handrail_wid+step_wid2,0.001,
				standard_x-step_tread,step_wid1+handrail_wid+step_wid2,0.001,
				standard_x-step_tread,step_wid1+handrail_wid+step_wid2,0

			del 1

		addz -floor_hei
		next i
		del floor_landing_num+1
	endif
endgroup

fin_landing_1=subgroup("fin_landing",handrail1)
fin_landing_2=subgroup(fin_landing_1,"step_ditch")
fin_landing_3=subgroup{2}(fin_landing_2,"RD_space",fin_ditch,fin_ditch,fin_ditch)
fin_landing_4=subgroup(fin_landing_3,"hide_floor_landing")



!==============================================溝仕上
group "fin_ditch"

	if step_ditch then

		for j=1 to floor_num-1
		
			for i=1 to step_num_down

				material fin_ditch2

				if i<step_num_down then
					tube 9,5,1+2+16+32+64,
					0,fin_ditch_hei,0,
					0.001,fin_ditch_hei,0,
					0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,0,0,
					ditch_wid,0,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0,0,
					-step_tread-step_nosing,y_down,0,0,
					0,y_down,0,0,
					-step_nosing,y_down,step_riser-step_rat,0,
					step_tread,y_down,step_riser,0,
					step_tread-step_nosing,y_down,2*step_riser,0
				else
					tube 9,4,1+2+16+32+64,
					0,fin_ditch_hei,0,
					0.001,fin_ditch_hei,0,
					0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,0,0,
					ditch_wid,0,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0,0,
					-step_tread-step_nosing,y_down,0,0,
					0,y_down,0,0,
					-step_nosing,y_down,step_riser,0,
					step_tread,y_down,step_riser,0
				endif
		
			add step_tread,0,step_riser
			next i
			del step_num_down

			if landing_ditch=0 then
			
				material fin_ditch2

				tube 9,6,1+2+16+32+64,
				0,fin_ditch_hei,0,
				0.001,fin_ditch_hei,0,
				0.001,-ditch_dep+0.001,0,
				ditch_wid-0.001,-ditch_dep+0.001,0,
				ditch_wid-0.001,0,0,
				ditch_wid,0,0,
				ditch_wid,-ditch_dep,0,
				0,-ditch_dep,0,
				0,0,0,
				(step_num_down-1)*step_tread,y_down,(step_num_down-1)*step_riser,0,
				(step_num_down-1)*step_tread-step_nosing,y_down,step_num_down*step_riser,0,
				(step_num_down-1)*step_tread+landing_1,y_down,step_num_down*step_riser,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing-ditch_wid,y_down,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing,y_down,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+2*landing_dep-x_landing,y_down,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0
			
				tube 9,6,1+2+16+32+64,
				0,fin_ditch_hei,0,
				0.001,fin_ditch_hei,0,
				0.001,-ditch_dep+0.001,0,
				ditch_wid-0.001,-ditch_dep+0.001,0,
				ditch_wid-0.001,0,0,
				ditch_wid,0,0,
				ditch_wid,-ditch_dep,0,
				0,-ditch_dep,0,
				0,0,0,
				(step_num_down-1)*step_tread+landing_1+2*landing_dep-x_landing,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing  ,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing-ditch_wid,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser,0,
				(step_num_down-1)*step_tread+landing_1-landing_2,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser,0,
				(step_num_down-1)*step_tread+landing_1-landing_2+step_nosing,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser+step_riser,0
			
			else
			
				material fin_ditch2

				tube 9,6,1+2+16+32+64,
				0,fin_ditch_hei,0,
				0.001,fin_ditch_hei,0,
				0.001,-ditch_dep+0.001,0,
				ditch_wid-0.001,-ditch_dep+0.001,0,
				ditch_wid-0.001,0,0,
				ditch_wid,0,0,
				ditch_wid,-ditch_dep,0,
				0,-ditch_dep,0,
				0,0,0,
				(step_num_down-1)*step_tread,y_down,(step_num_down-1)*step_riser,0,
				(step_num_down-1)*step_tread-step_nosing,y_down,step_num_down*step_riser,0,
				(step_num_down-1)*step_tread+landing_1,y_down,step_num_down*step_riser,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing-ditch_wid,y_down,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing,y_down,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0

				material fin_ditch

				tube 9,4,1+2+16+32+64,
				0,fin_ditch_hei,0,
				0.001,fin_ditch_hei,0,
				0.001,-ditch_dep+0.001,0,
				ditch_wid-0.001,-ditch_dep+0.001,0,
				ditch_wid-0.001,0,0,
				ditch_wid,0,0,
				ditch_wid,-ditch_dep,0,
				0,-ditch_dep,0,
				0,0,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing-ditch_wid,y_down,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing,y_down,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing-ditch_wid,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0

				material fin_ditch2

				tube 9,6,1+2+16+32+64,
				0,fin_ditch_hei,0,
				0.001,fin_ditch_hei,0,
				0.001,-ditch_dep+0.001,0,
				ditch_wid-0.001,-ditch_dep+0.001,0,
				ditch_wid-0.001,0,0,
				ditch_wid,0,0,
				ditch_wid,-ditch_dep,0,
				0,-ditch_dep,0,
				0,0,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing,y_down,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing-ditch_wid,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser,0,
				(step_num_down-1)*step_tread+landing_1-landing_2,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser,0,
				(step_num_down-1)*step_tread+landing_1-landing_2+step_nosing,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser+step_riser,0

			endif

			add (step_num_down-1)*step_tread+landing_1-landing_2,0,step_num_down*step_riser
			for i=1 to step_num_up
			
				material fin_ditch2

				if i<step_num_up then
					tube 9,5,1+2+16+32+64,
					0,fin_ditch_hei,0,
					0.001,fin_ditch_hei,0,
					0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,0,0,
					ditch_wid,0,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0,0,
					step_tread+step_nosing,step_wid1+handrail_wid+step_wid2-y_up,0,0,
					0,step_wid1+handrail_wid+step_wid2-y_up,0,0,
					step_nosing,step_wid1+handrail_wid+step_wid2-y_up,step_riser-step_rat,0,
					-step_tread,step_wid1+handrail_wid+step_wid2-y_up,step_riser,0,
					-step_tread+step_nosing,step_wid1+handrail_wid+step_wid2-y_up,2*step_riser,0
				else
					tube 9,4,1+2+16+32+64,
					0,fin_ditch_hei,0,
					0.001,fin_ditch_hei,0,
					0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,0,0,
					ditch_wid,0,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0,0,
					step_tread+step_nosing,step_wid1+handrail_wid+step_wid2-y_up,0,0,
					0,step_wid1+handrail_wid+step_wid2-y_up,0,0,
					step_nosing,step_wid1+handrail_wid+step_wid2-y_up,step_riser,0,
					-step_tread,step_wid1+handrail_wid+step_wid2-y_up,step_riser,0
				endif
		
			add -step_tread,0,step_riser
			next i
			del step_num_up+1

		addz floor_hei
		next j
		del floor_num-1

		addz (floor_num-2)*floor_hei
		for j=1 to z_1

			if switch_floor=0 or floor_ditch=0 then

				material fin_ditch2

				tube 9,6,1+2+16+32+64,
				0,fin_ditch_hei,0,
				0.001,fin_ditch_hei,0,
				0.001,-ditch_dep+0.001,0,
				ditch_wid-0.001,-ditch_dep+0.001,0,
				ditch_wid-0.001,0,0,
				ditch_wid,0,0,
				ditch_wid,-ditch_dep,0,
				0,-ditch_dep,0,
				0,0,0,
				standard_x,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-step_riser,0,
				standard_x+step_nosing   ,step_wid1+handrail_wid+step_wid2-y_up,floor_hei,0,
				min(standard_x,0)-floor_1,step_wid1+handrail_wid+step_wid2-y_up,floor_hei,0,
				min(standard_x,0)-floor_1-floor_dep+x_floor+ditch_wid,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
				min(standard_x,0)-floor_1-floor_dep+x_floor  ,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
				min(standard_x,0)-floor_1-2*floor_dep+x_floor,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0
	
				if j>1 then
				
					tube 9,6,1+2+16+32+64,
					0,fin_ditch_hei,0,
					0.001,fin_ditch_hei,0,
					0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,0,0,
					ditch_wid,0,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0,0,
					min(standard_x,0)-floor_1-2*floor_dep+x_floor,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor+ditch_wid,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1,y_down,floor_hei,0,
					0,y_down,floor_hei,0,
					-step_nosing,y_down,floor_hei+step_riser,0
				
				else
				
					tube 9,5,1+2+16+32+64,
					0,fin_ditch_hei,0,
					0.001,fin_ditch_hei,0,
					0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,0,0,
					ditch_wid,0,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0,0,
					min(standard_x,0)-floor_1-2*floor_dep+x_floor,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor+ditch_wid,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-x_floor2,y_down,floor_hei-(x_floor2*floor_rat/100),0,
					min(standard_x,0)-floor_1-x_floor2+(floor_dep-x_floor2),y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0
	
				endif

			else

				if j>1 then

					material fin_ditch2

					tube 9,6,1+2+16+32+64,
					0,fin_ditch_hei,0,
					0.001,fin_ditch_hei,0,
					0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,0,0,
					ditch_wid,0,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0,0,
					standard_x,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-step_riser,0,
					standard_x+step_nosing   ,step_wid1+handrail_wid+step_wid2-y_up,floor_hei,0,
					min(standard_x,0)-floor_1,step_wid1+handrail_wid+step_wid2-y_up,floor_hei,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor+ditch_wid,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0

					material fin_ditch

					tube 9,4,1+2+16+32+64,
					0,fin_ditch_hei,0,
					0.001,fin_ditch_hei,0,
					0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,0,0,
					ditch_wid,0,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor+ditch_wid,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor+ditch_wid,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0

					material fin_ditch2

					tube 9,6,1+2+16+32+64,
					0,fin_ditch_hei,0,
					0.001,fin_ditch_hei,0,
					0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,0,0,
					ditch_wid,0,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor+ditch_wid,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1,y_down,floor_hei,0,
					0,y_down,floor_hei,0,
					-step_nosing,y_down,floor_hei+step_riser,0

				else

					material fin_ditch2

					tube 9,6,1+2+16+32+64,
					0,fin_ditch_hei,0,
					0.001,fin_ditch_hei,0,
					0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,0,0,
					ditch_wid,0,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0,0,
					standard_x,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-step_riser,0,
					standard_x+step_nosing   ,step_wid1+handrail_wid+step_wid2-y_up,floor_hei,0,
					min(standard_x,0)-floor_1,step_wid1+handrail_wid+step_wid2-y_up,floor_hei,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor+ditch_wid,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0

					material fin_ditch

					tube 9,4,1+2+16+32+64,
					0,fin_ditch_hei,0,
					0.001,fin_ditch_hei,0,
					0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,0,0,
					ditch_wid,0,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor+ditch_wid,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor+ditch_wid,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0

					material fin_ditch2

					tube 9,5,1+2+16+32+64,
					0,fin_ditch_hei,0,
					0.001,fin_ditch_hei,0,
					0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,0,0,
					ditch_wid,0,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-floor_dep+x_floor+ditch_wid,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
					min(standard_x,0)-floor_1-x_floor2,y_down,floor_hei-(x_floor2*floor_rat/100),0,
					min(standard_x,0)-floor_1-x_floor2+(floor_dep-x_floor2),y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0

				endif

			endif

		addz -floor_hei
		next j
		del z_1
		del 1

		if switch_gl then

			material fin_ditch2

			for i=1 to gl_num

				if i=1 then

					tube 9,4,1+2+16+32+64,
					0,fin_ditch_hei,0,
					0.001,fin_ditch_hei,0,
					0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,0,0,
					ditch_wid,0,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0,0,
					standard_x+step_tread,step_wid1+handrail_wid+step_wid2-y_up,-step_riser,0,
					standard_x,step_wid1+handrail_wid+step_wid2-y_up,-step_riser,0,
					standard_x+step_nosing,step_wid1+handrail_wid+step_wid2-y_up,0,0,
					standard_x-step_tread ,step_wid1+handrail_wid+step_wid2-y_up,0,0

				endif

				if i>1 and i<gl_num then

					tube 9,5,1+2+16+32+64,
					0,fin_ditch_hei,0,
					0.001,fin_ditch_hei,0,
					0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,-ditch_dep+0.001,0,
					ditch_wid-0.001,0,0,
					ditch_wid,0,0,
					ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0,0,
					standard_x+step_tread,step_wid1+handrail_wid+step_wid2-y_up,-step_riser,0,
					standard_x,step_wid1+handrail_wid+step_wid2-y_up,-step_riser,0,
					standard_x+step_nosing,step_wid1+handrail_wid+step_wid2-y_up,-step_rat,0,
					standard_x-step_tread ,step_wid1+handrail_wid+step_wid2-y_up,0,0,
					standard_x-step_tread+step_nosing,step_wid1+handrail_wid+step_wid2-y_up,step_riser,0

				endif

				if i=gl_num then
				
					tube 9,5,1+2+16+32+64,
					0,fin_ditch_hei,0,
					-0.001,fin_ditch_hei,0,
					-0.001,-ditch_dep+0.001,0,
					-ditch_wid+0.001,-ditch_dep+0.001,0,
					-ditch_wid+0.001,0,0,
					-ditch_wid,0,0,
					-ditch_wid,-ditch_dep,0,
					0,-ditch_dep,0,
					0,0,0,
					standard_x-step_tread+step_nosing,step_wid1+handrail_wid+step_wid2-y_up,step_riser,0,
					standard_x-step_tread ,step_wid1+handrail_wid+step_wid2-y_up,0,0,
					standard_x+step_nosing,step_wid1+handrail_wid+step_wid2-y_up,-step_rat,0,
					standard_x,step_wid1+handrail_wid+step_wid2-y_up,-step_riser,0,
					standard_x+step_nosing,step_wid1+handrail_wid+step_wid2-y_up,-2*step_riser,0
				endif

			add step_tread,0,-step_riser
			next i
			del gl_num

		endif

	else

		material fin_ditch

		if landing_ditch then
		
			for j=1 to floor_num-1

				tube 9,4,1+2+16+32+64,
				0,fin_ditch_hei,0,
				0.001,fin_ditch_hei,0,
				0.001,-ditch_dep+0.001,0,
				ditch_wid-0.001,-ditch_dep+0.001,0,
				ditch_wid-0.001,0,0,
				ditch_wid,0,0,
				ditch_wid,-ditch_dep,0,
				0,-ditch_dep,0,
				0,0,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing,y_down-1,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing,y_down,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing,step_wid1+handrail_wid+step_wid2-y_up,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0,
				(step_num_down-1)*step_tread+landing_1+landing_dep-x_landing,step_wid1+handrail_wid+step_wid2-y_up+1,step_num_down*step_riser-(landing_dep-x_landing-ditch_wid)*landing_rat/100,0

			addz floor_hei
			next j
			del floor_num-1

		endif
		
		if switch_floor and floor_ditch then
			
			addz (floor_num-2)*floor_hei
			for j=1 to z_1

				tube 9,4,1+2+16+32+64,
				0,fin_ditch_hei,0,
				0.001,fin_ditch_hei,0,
				0.001,-ditch_dep+0.001,0,
				ditch_wid-0.001,-ditch_dep+0.001,0,
				ditch_wid-0.001,0,0,
				ditch_wid,0,0,
				ditch_wid,-ditch_dep,0,
				0,-ditch_dep,0,
				0,0,0,
				min(standard_x,0)-floor_1-floor_dep+x_floor,step_wid1+handrail_wid+step_wid2-y_up+1,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
				min(standard_x,0)-floor_1-floor_dep+x_floor,step_wid1+handrail_wid+step_wid2-y_up,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
				min(standard_x,0)-floor_1-floor_dep+x_floor,y_down,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0,
				min(standard_x,0)-floor_1-floor_dep+x_floor,y_down-1,floor_hei-(floor_dep-x_floor-ditch_wid)*floor_rat/100,0

			addz -floor_hei
			next j
			del z_1
			del 1


		endif

	endif

endgroup


group "fin_ditch2"

	material fin_ditch2

	if step_ditch then

		addy y_down !下部階段
		for j=1 to floor_num-1
		
			if j=1 and switch_gl=0 then
			
				ruledsegmented 6,1+2+4+16+32,
				(step_num_down-1)*step_tread-step_nosing-fin_ditch_hei*tan(step_a),0,step_num_down*step_riser+fin_ditch_hei,0,
				(step_num_down-1)*step_tread,0,(step_num_down-1)*step_riser,0,
				0,0,0,0,
				-step_tread,0,0,0,
				-step_tread,0,fin_ditch_hei+(step_nosing+fin_ditch_hei*tan(step_a))*tan(step_angle),0,
				(step_num_down-1)*step_tread-step_nosing-fin_ditch_hei*tan(step_a),0,step_num_down*step_riser+fin_ditch_hei,0,
				(step_num_down-1)*step_tread-step_nosing-fin_ditch_hei*tan(step_a),0.001,step_num_down*step_riser+fin_ditch_hei,
				(step_num_down-1)*step_tread,0.001,(step_num_down-1)*step_riser,
				0,0.001,0,
				-step_tread,0.001,0,
				-step_tread,0.001,fin_ditch_hei+(step_nosing+fin_ditch_hei*tan(step_a))*tan(step_angle),
				(step_num_down-1)*step_tread-step_nosing-fin_ditch_hei*tan(step_a),0.001,step_num_down*step_riser+fin_ditch_hei
			
			else
			
				ruledsegmented 5,1+2+4+16+32,
				(step_num_down-1)*step_tread-step_nosing-fin_ditch_hei*tan(step_a),0,step_num_down*step_riser+fin_ditch_hei,0,
				(step_num_down-1)*step_tread,0,(step_num_down-1)*step_riser,0,
				0,0,0,0,
				-step_nosing-step_tread-fin_ditch_hei*tan(step_a)-(fin_ditch_hei+floor_dep*floor_rat/100)/tan(step_angle),0,-floor_dep*floor_rat/100,0,
				(step_num_down-1)*step_tread-step_nosing-fin_ditch_hei*tan(step_a),0,step_num_down*step_riser+fin_ditch_hei,0,
				(step_num_down-1)*step_tread-step_nosing-fin_ditch_hei*tan(step_a),0.001,step_num_down*step_riser+fin_ditch_hei,
				(step_num_down-1)*step_tread,0.001,(step_num_down-1)*step_riser,
				0,0.001,0,
				-step_nosing-step_tread-fin_ditch_hei*tan(step_a)-(fin_ditch_hei+floor_dep*floor_rat/100)/tan(step_angle),0.001,-floor_dep*floor_rat/100,
				(step_num_down-1)*step_tread-step_nosing-fin_ditch_hei*tan(step_a),0.001,step_num_down*step_riser+fin_ditch_hei
				
			endif
	
		addz floor_hei
		next j
		del floor_num-1	
		del 1

		addy step_wid1+handrail_wid+step_wid2-y_up !上部階段
		for j=1 to floor_num-1

			ruledsegmented 5,1+2+4+16+32,
			standard_x+step_nosing+fin_ditch_hei*tan(step_a),0,floor_hei+fin_ditch_hei,0,
			standard_x,0,floor_hei-step_riser,0,
			standard_x+(step_num_up-1)*step_tread,0,floor_hei-step_num_up*step_riser,0,
			standard_x+step_nosing+fin_ditch_hei*tan(step_a)+(fin_ditch_hei+step_num_up*step_riser+landing_dep*landing_rat/100)/tan(step_angle),0,floor_hei-step_num_up*step_riser-landing_dep*landing_rat/100,0,
			standard_x+step_nosing+fin_ditch_hei*tan(step_a),0,floor_hei+fin_ditch_hei,0,
			standard_x+step_nosing+fin_ditch_hei*tan(step_a),-0.001,floor_hei+fin_ditch_hei,
			standard_x,-0.001,floor_hei-step_riser,
			standard_x+(step_num_up-1)*step_tread,-0.001,floor_hei-step_num_up*step_riser,
			standard_x+step_nosing+fin_ditch_hei*tan(step_a)+(fin_ditch_hei+step_num_up*step_riser+landing_dep*landing_rat/100)/tan(step_angle),-0.001,floor_hei-step_num_up*step_riser-landing_dep*landing_rat/100,
			standard_x+step_nosing+fin_ditch_hei*tan(step_a),-0.001,floor_hei+fin_ditch_hei

		addz floor_hei
		next j
		del floor_num-1	
		del 1

		if switch_gl then

			addy step_wid1+handrail_wid+step_wid2-y_up !1階下がり階段

			ruledsegmented 6,1+2+4+16+32,
			standard_x+step_nosing+fin_ditch_hei*tan(step_a),0,fin_ditch_hei,0,
			standard_x,0,-step_riser,0,
			standard_x+(gl_num-1)*step_tread,0,-gl_num*step_riser,0,
			standard_x+gl_num*step_tread,0,-gl_num*step_riser,0,
			standard_x+gl_num*step_tread,0,fin_ditch_hei-(gl_num*step_tread-step_nosing-fin_ditch_hei*tan(step_a))*tan(step_angle),0,
			standard_x+step_nosing+fin_ditch_hei*tan(step_a),0,fin_ditch_hei,0,
			standard_x+step_nosing+fin_ditch_hei*tan(step_a),-0.001,fin_ditch_hei,
			standard_x,-0.001,-step_riser,
			standard_x+(gl_num-1)*step_tread,-0.001,-gl_num*step_riser,
			standard_x+gl_num*step_tread,-0.001,-gl_num*step_riser,
			standard_x+gl_num*step_tread,-0.001,fin_ditch_hei-(gl_num*step_tread-step_nosing-fin_ditch_hei*tan(step_a))*tan(step_angle),
			standard_x+step_nosing+fin_ditch_hei*tan(step_a),-0.001,fin_ditch_hei
		
			del 1

		endif

	endif

endgroup


group "fin_ditch_minus"

	if switch_gl=0 then

	ruledsegmented 5,1+2+4+16+32,
	step_tread,0,0,0,
	step_tread,0,-floor_thi,0,
	min(standard_x,0)-floor_1,0,-floor_thi,0,
	min(standard_x,0)-floor_1,0,0,0,
	step_tread,0,0,0,
	step_tread,step_wid1,0,
	step_tread,step_wid1,-floor_thi,
	min(standard_x,0)-floor_1,step_wid1,-floor_thi,
	min(standard_x,0)-floor_1,step_wid1,0,
	step_tread,step_wid1,0

	ruledsegmented 5,1+2+4+16+32,
	min(standard_x,0)-floor_1,0,0,0,
	min(standard_x,0)-floor_1,0,-floor_thi,0,
	min(standard_x,0)-floor_1-floor_dep,0,-floor_thi,0,
	min(standard_x,0)-floor_1-floor_dep,0,-floor_dep*floor_rat/100,0,
	min(standard_x,0)-floor_1,0,0,0,
	min(standard_x,0)-floor_1,step_wid1+handrail_wid+step_wid2,0,
	min(standard_x,0)-floor_1,step_wid1+handrail_wid+step_wid2,-floor_thi,
	min(standard_x,0)-floor_1-floor_dep,step_wid1+handrail_wid+step_wid2,-floor_thi,
	min(standard_x,0)-floor_1-floor_dep,step_wid1+handrail_wid+step_wid2,-floor_dep*floor_rat/100,
	min(standard_x,0)-floor_1,step_wid1+handrail_wid+step_wid2,0

	endif

endgroup


fin_ditch_1=addgroup("fin_ditch","fin_ditch2")
fin_ditch_2=subgroup(fin_ditch_1,"fin_ditch_minus")
fin_ditch_3=subgroup(fin_ditch_2,step5)
fin_ditch_4=subgroup{2}(fin_ditch_3,"RD_space",fin_ditch,fin_ditch,fin_ditch)
fin_ditch_5=subgroup(fin_ditch_4,"hide_floor_landing3")


!======================================================================立上り天端
group "fin_hr_top1"
	addz 0.001
	placegroup handrail1
	del 1
endgroup


group "fin_hr_top2"
	placegroup subgroup{2}("fin_hr_top1",handrail1,fin_hr_up,fin_hr_up,fin_hr_up)
endgroup


group "step_body"
	placegroup addgroup(step8,handrail1)
endgroup


group "step_body2"
	placegroup addgroup(step6,"handrail_uchi")
endgroup


!======================================================================外側立上り内側
group "fin_hr_inside1"

	if switch_fin then
	
		material fin_hr_inside

		for j=1 to floor_num-1
	
			if switch_hr1 then
	
				if switch_gl=0 and j=1 then
					ruledsegmented 7,1+2+4+16+32+64,
					-step_tread,hr_wid+0.001,0,0,
					0,hr_wid+0.001,0,0,
					(step_num_down-1)*step_tread,hr_wid+0.001,(step_num_down-1)*step_riser,0,
					(step_num_down-1)*step_tread+(landing_hr_hei-hr_hei)/tan(step_angle),hr_wid+0.001,(step_num_down-1)*step_riser,0,
					(step_num_down-1)*step_tread+(landing_hr_hei-hr_hei)/tan(step_angle),hr_wid+0.001,step_num_down*step_riser+landing_hr_hei,0,
					-step_tread,hr_wid+0.001,hr_hei,0,
					-step_tread,hr_wid+0.001,0,0,
					-step_tread,hr_wid,0,
					0,hr_wid,0,
					(step_num_down-1)*step_tread,hr_wid,(step_num_down-1)*step_riser,
					(step_num_down-1)*step_tread+(landing_hr_hei-hr_hei)/tan(step_angle),hr_wid,(step_num_down-1)*step_riser,
					(step_num_down-1)*step_tread+(landing_hr_hei-hr_hei)/tan(step_angle),hr_wid,step_num_down*step_riser+landing_hr_hei,
					-step_tread,hr_wid,hr_hei,
					-step_tread,hr_wid,0
				else
					ruledsegmented 6,1+2+4+16+32+64,
					-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),hr_wid+0.001,-step_riser+(floor_hr_hei-hr_hei),0,
					(step_num_down-1)*step_tread,hr_wid+0.001,(step_num_down-1)*step_riser,0,
					(step_num_down-1)*step_tread+(landing_hr_hei-hr_hei)/tan(step_angle),hr_wid+0.001,(step_num_down-1)*step_riser,0,
					(step_num_down-1)*step_tread+(landing_hr_hei-hr_hei)/tan(step_angle),hr_wid+0.001,step_num_down*step_riser+landing_hr_hei,0,
					-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),hr_wid+0.001,floor_hr_hei,0,
					-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),hr_wid+0.001,-step_riser+(floor_hr_hei-hr_hei),0,
					-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),hr_wid,-step_riser+(floor_hr_hei-hr_hei),
					(step_num_down-1)*step_tread,hr_wid,(step_num_down-1)*step_riser,
					(step_num_down-1)*step_tread+(landing_hr_hei-hr_hei)/tan(step_angle),hr_wid,(step_num_down-1)*step_riser,
					(step_num_down-1)*step_tread+(landing_hr_hei-hr_hei)/tan(step_angle),hr_wid,step_num_down*step_riser+landing_hr_hei,
					-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),hr_wid,floor_hr_hei,
					-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),hr_wid,-step_riser+(floor_hr_hei-hr_hei)
				endif

				add (step_num_down-1)*step_tread+landing_1-landing_2,step_wid1+handrail_wid+step_wid2,step_num_down*step_riser
			
				ruledsegmented 6,1+2+4+16+32+64,
				step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),-hr_wid-0.001,(landing_hr_hei-hr_hei)-step_riser,0,
				-(step_num_up-1)*step_tread,-hr_wid-0.001,(step_num_up-1)*step_riser,0,
				-(step_num_up-1)*step_tread-(floor_hr_hei-hr_hei)/tan(step_angle),-hr_wid-0.001,(step_num_up-1)*step_riser,0,
				-(step_num_up-1)*step_tread-(floor_hr_hei-hr_hei)/tan(step_angle),-hr_wid-0.001,step_num_up*step_riser+floor_hr_hei,0,
				step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),-hr_wid-0.001,landing_hr_hei,0,
				step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),-hr_wid-0.001,(landing_hr_hei-hr_hei)-step_riser,0,
				step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),-hr_wid,(landing_hr_hei-hr_hei)-step_riser,
				-(step_num_up-1)*step_tread,-hr_wid,(step_num_up-1)*step_riser,
				-(step_num_up-1)*step_tread-(floor_hr_hei-hr_hei)/tan(step_angle),-hr_wid,(step_num_up-1)*step_riser,
				-(step_num_up-1)*step_tread-(floor_hr_hei-hr_hei)/tan(step_angle),-hr_wid,step_num_up*step_riser+floor_hr_hei,
				step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),-hr_wid,landing_hr_hei,
				step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),-hr_wid,(landing_hr_hei-hr_hei)-step_riser
		
				del 1
	
			endif
		
		addz floor_hei
		next j
		del floor_num-1
	
	endif

endgroup


group "fin_hr_inside2"
	if switch_fin then
		material fin_hr_inside
	
		!中間踊り場外側立上り内側仕上げ
		for j=1 to floor_num-1
	
			add (step_num_down-1)*step_tread,0,step_num_down*step_riser-landing_dep*landing_rat/100
	
			ruledsegmented 7,1+2+4+16+32+64,
			(landing_hr_hei-hr_hei)/tan(step_angle),hr_wid,0,0,
			landing_1+landing_dep-hr_wid2,hr_wid,0,0,
			landing_1+landing_dep-hr_wid2,step_wid1+handrail_wid+step_wid2-hr_wid,0,0,
			landing_1+landing_dep-hr_wid2-0.001,step_wid1+handrail_wid+step_wid2-hr_wid,0,0,
			landing_1+landing_dep-hr_wid2-0.001,hr_wid+0.001,0,0,
			(landing_hr_hei-hr_hei)/tan(step_angle),hr_wid+0.001,0,0,
			(landing_hr_hei-hr_hei)/tan(step_angle),hr_wid,0,0,
			(landing_hr_hei-hr_hei)/tan(step_angle),hr_wid,landing_dep*landing_rat/100+landing_hr_hei,
			landing_1+landing_dep-hr_wid2,hr_wid,landing_dep*landing_rat/100+landing_hr_hei,
			landing_1+landing_dep-hr_wid2,step_wid1+handrail_wid+step_wid2-hr_wid,landing_dep*landing_rat/100+landing_hr_hei,
			landing_1+landing_dep-hr_wid2-0.001,step_wid1+handrail_wid+step_wid2-hr_wid,landing_dep*landing_rat/100+landing_hr_hei,
			landing_1+landing_dep-hr_wid2-0.001,hr_wid+0.001,landing_dep*landing_rat/100+landing_hr_hei,
			(landing_hr_hei-hr_hei)/tan(step_angle),hr_wid+0.001,landing_dep*landing_rat/100+landing_hr_hei,
			(landing_hr_hei-hr_hei)/tan(step_angle),hr_wid,landing_dep*landing_rat/100+landing_hr_hei
	
			del 1

			add (step_num_down-1)*step_tread+landing_1-landing_2,step_wid1+handrail_wid+step_wid2,step_num_down*step_riser
	
			ruledsegmented 6,1+2+4+16+32+64,
			step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),-hr_wid-0.001,(landing_hr_hei-hr_hei)-step_riser,0,
			0,-hr_wid-0.001,-landing_dep*landing_rat/100,0,
			landing_2+landing_dep-hr_wid2,-hr_wid-0.001,-landing_dep*landing_rat/100,0,
			landing_2+landing_dep-hr_wid2,-hr_wid-0.001,landing_hr_hei,0,
			step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),-hr_wid-0.001,landing_hr_hei,0,
			step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),-hr_wid-0.001,(landing_hr_hei-hr_hei)-step_riser,0,
			step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),-hr_wid,(landing_hr_hei-hr_hei)-step_riser,
			0,-hr_wid,-landing_dep*landing_rat/100,
			landing_2+landing_dep-hr_wid2,-hr_wid,-landing_dep*landing_rat/100,
			landing_2+landing_dep-hr_wid2,-hr_wid,landing_hr_hei,
			step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),-hr_wid,landing_hr_hei,
			step_tread-(landing_hr_hei-hr_hei)/tan(step_angle),-hr_wid,(landing_hr_hei-hr_hei)-step_riser
	
			del 1
	
		addz floor_hei
		next j
		del floor_num-1

		!フロア踊り場外側立上り内側仕上げ
		for j=1 to floor_num-2+switch_gl
	
			addz floor_hei-floor_dep*floor_rat/100+(floor_num-3)*floor_hei
	
			ruledsegmented 7,1+2+4+16+32+64,
			standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2-hr_wid,0,0,
			min(standard_x,0)-floor_1-floor_dep+hr_wid2,step_wid1+handrail_wid+step_wid2-hr_wid,0,0,
			min(standard_x,0)-floor_1-floor_dep+hr_wid2,hr_wid,0,0,
			min(standard_x,0)-floor_1-floor_dep+hr_wid2+0.001,hr_wid,0,0,
			min(standard_x,0)-floor_1-floor_dep+hr_wid2+0.001,step_wid1+handrail_wid+step_wid2-hr_wid-0.001,0,0,
			standard_x-(floor_hr_hei-hr_hei)/tan(step_angle) ,step_wid1+handrail_wid+step_wid2-hr_wid-0.001,0,0,
			standard_x-(floor_hr_hei-hr_hei)/tan(step_angle) ,step_wid1+handrail_wid+step_wid2-hr_wid,0,0,
			standard_x-(floor_hr_hei-hr_hei)/tan(step_angle) ,step_wid1+handrail_wid+step_wid2-hr_wid,floor_dep*floor_rat/100+floor_hr_hei,
			min(standard_x,0)-floor_1-floor_dep+hr_wid2,step_wid1+handrail_wid+step_wid2-hr_wid,floor_dep*floor_rat/100+floor_hr_hei,
			min(standard_x,0)-floor_1-floor_dep+hr_wid2,hr_wid,floor_dep*floor_rat/100+floor_hr_hei,
			min(standard_x,0)-floor_1-floor_dep+hr_wid2+0.001,hr_wid,floor_dep*floor_rat/100+floor_hr_hei,
			min(standard_x,0)-floor_1-floor_dep+hr_wid2+0.001,step_wid1+handrail_wid+step_wid2-hr_wid-0.001,floor_dep*floor_rat/100+floor_hr_hei,
			standard_x-(floor_hr_hei-hr_hei)/tan(step_angle) ,step_wid1+handrail_wid+step_wid2-hr_wid-0.001,floor_dep*floor_rat/100+floor_hr_hei,
			standard_x-(floor_hr_hei-hr_hei)/tan(step_angle) ,step_wid1+handrail_wid+step_wid2-hr_wid,floor_dep*floor_rat/100+floor_hr_hei
	
			del 1

			addz (floor_num-2)*floor_hei
	
			ruledsegmented 6,1+2+4+16+32+64,
			-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),hr_wid+0.001,-step_riser+(floor_hr_hei-hr_hei),0,
			0,hr_wid+0.001,0,0,
			min(standard_x,0)-floor_1-floor_dep+hr_wid2,hr_wid+0.001,-floor_dep*floor_rat/100,0,
			min(standard_x,0)-floor_1-floor_dep+hr_wid2,hr_wid+0.001,floor_hr_hei,0,
			-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),hr_wid+0.001,floor_hr_hei,0,
			-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),hr_wid+0.001,-step_riser+(floor_hr_hei-hr_hei),0,
			-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),hr_wid,-step_riser+(floor_hr_hei-hr_hei),
			0,hr_wid,0,
			min(standard_x,0)-floor_1-floor_dep+hr_wid2,hr_wid,-floor_dep*floor_rat/100,
			min(standard_x,0)-floor_1-floor_dep+hr_wid2,hr_wid,floor_hr_hei,
			-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),hr_wid,floor_hr_hei,
			-step_tread+(floor_hr_hei-hr_hei)/tan(step_angle),hr_wid,-step_riser+(floor_hr_hei-hr_hei)
	
			del 1
	
		addz -floor_hei
		next j
		del floor_num-2+switch_gl
	
		addz (floor_num-1)*floor_hei-floor_dep*floor_rat/100
	
		ruledsegmented 9,1+2+4+8+16+32+64,
		standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2-hr_wid,0,0,
		min(standard_x,0)-floor_1-floor_dep+hr_wid2,step_wid1+handrail_wid+step_wid2-hr_wid,0,0,
		min(standard_x,0)-floor_1-floor_dep+hr_wid2,hr_wid,0,0,
		min(standard_x,0)-floor_1,hr_wid,0,0,
		min(standard_x,0)-floor_1,hr_wid+0.001,0,0,
		min(standard_x,0)-floor_1-floor_dep+hr_wid2+0.001,hr_wid+0.001,0,0,
		min(standard_x,0)-floor_1-floor_dep+hr_wid2+0.001,step_wid1+handrail_wid+step_wid2-hr_wid-0.001,0,0,
		standard_x-(floor_hr_hei-hr_hei)/tan(step_angle) ,step_wid1+handrail_wid+step_wid2-hr_wid-0.001,0,0,
		standard_x-(floor_hr_hei-hr_hei)/tan(step_angle) ,step_wid1+handrail_wid+step_wid2-hr_wid,0,0,
		standard_x-(floor_hr_hei-hr_hei)/tan(step_angle) ,step_wid1+handrail_wid+step_wid2-hr_wid,floor_dep*floor_rat/100+floor_hr_hei,
		min(standard_x,0)-floor_1-floor_dep+hr_wid2,step_wid1+handrail_wid+step_wid2-hr_wid,floor_dep*floor_rat/100+floor_hr_hei,
		min(standard_x,0)-floor_1-floor_dep+hr_wid2,hr_wid,floor_dep*floor_rat/100+floor_hr_hei,
		min(standard_x,0)-floor_1,hr_wid,floor_dep*floor_rat/100+floor_hr_hei,
		min(standard_x,0)-floor_1,hr_wid+0.001,floor_dep*floor_rat/100+floor_hr_hei,
		min(standard_x,0)-floor_1-floor_dep+hr_wid2+0.001,hr_wid+0.001,floor_dep*floor_rat/100+floor_hr_hei,
		min(standard_x,0)-floor_1-floor_dep+hr_wid2+0.001,step_wid1+handrail_wid+step_wid2-hr_wid-0.001,floor_dep*floor_rat/100+floor_hr_hei,
		standard_x-(floor_hr_hei-hr_hei)/tan(step_angle) ,step_wid1+handrail_wid+step_wid2-hr_wid-0.001,floor_dep*floor_rat/100+floor_hr_hei,
		standard_x-(floor_hr_hei-hr_hei)/tan(step_angle) ,step_wid1+handrail_wid+step_wid2-hr_wid,floor_dep*floor_rat/100+floor_hr_hei

		del 1
	endif
endgroup


group "fin_hr_inside4"
	if switch_fin then
		material fin_hr_inside
	
		if switch_gl then
	
			ruledsegmented 6,1+2+4+16+32+64,
			standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2-hr_wid-0.001,floor_hr_hei,0,
			standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2-hr_wid-0.001,0,0,
			standard_x+(gl_num-1)*step_tread,step_wid1+handrail_wid+step_wid2-hr_wid-0.001,-gl_num*step_riser,0,
			standard_x+gl_num*step_tread,step_wid1+handrail_wid+step_wid2-hr_wid-0.001,-gl_num*step_riser,0,
			standard_x+gl_num*step_tread,step_wid1+handrail_wid+step_wid2-hr_wid-0.001,-gl_num*step_riser+hr_hei,0,
			standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2-hr_wid-0.001,floor_hr_hei,0,
			standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2-hr_wid,floor_hr_hei,
			standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2-hr_wid,0,
			standard_x+(gl_num-1)*step_tread,step_wid1+handrail_wid+step_wid2-hr_wid,-gl_num*step_riser,
			standard_x+gl_num*step_tread,step_wid1+handrail_wid+step_wid2-hr_wid,-gl_num*step_riser,
			standard_x+gl_num*step_tread,step_wid1+handrail_wid+step_wid2-hr_wid,-gl_num*step_riser+hr_hei,
			standard_x-(floor_hr_hei-hr_hei)/tan(step_angle),step_wid1+handrail_wid+step_wid2-hr_wid,floor_hr_hei
	
		endif
	
	endif
endgroup


group "fin_hr_inside_plus"
	if switch_fin then
		material fin_hr_inside
	
		if switch_hr1 then

			if switch_gl=0 then

				if hr_hide<>2 then
					add -step_tread-0.001,0,0
					block 0.001,hr_wid,hr_hei
					del 1
				endif
			
			else
			
				if hr_hide<>3 then
					add standard_x+gl_num*step_tread,step_wid1+handrail_wid+step_wid2-hr_wid,-gl_num*step_riser
					block 0.001,hr_wid,hr_hei
					del 1
				endif

			endif

		endif
	endif
endgroup


fin_hr_inside_1=addgroup("fin_hr_inside1","fin_hr_inside2")
fin_hr_inside_3=addgroup(fin_hr_inside_1,"fin_hr_inside4")
fin_hr_inside_4=subgroup(fin_hr_inside_3,step4)
fin_hr_inside_5=subgroup(fin_hr_inside_4,fin_ditch_4)
fin_hr_inside_6=subgroup(fin_hr_inside_5,"handrail_uchi")

if switch_fin then
	fin_hr_inside_7=subgroup{2}(fin_hr_inside_6,"handrail_hide",fin_hr_inside,fin_hr_inside,fin_hr_inside)
else
	fin_hr_inside_7=subgroup(fin_hr_inside_6,"handrail_hide")
endif

fin_hr_inside_8=addgroup(fin_hr_inside_7,"fin_hr_inside_plus")
fin_hr_inside_9=subgroup(fin_hr_inside_8,fin_ditch_4)
fin_hr_inside_10=subgroup(fin_hr_inside_9,"hide_floor_landing")


!======================================================================外側立上り外側
group "fin_hr_outside1"

	if switch_fin then

		material fin_hr_outside
	
!		if switch_hr1 and hr_hide<>1 then

			ruledsegmented 5,1+2+4+16+32,
			min(standard_x,0)-floor_1-floor_dep,0,-gl_num*step_riser,0,
			min(standard_x,0)-floor_1-floor_dep,step_wid1+handrail_wid+step_wid2,-gl_num*step_riser,0,
			min(standard_x,0)-floor_1-floor_dep,step_wid1+handrail_wid+step_wid2,(floor_num-1)*floor_hei+floor_hr_hei,0,
			min(standard_x,0)-floor_1-floor_dep,0,(floor_num-1)*floor_hei+floor_hr_hei,0,
			min(standard_x,0)-floor_1-floor_dep,0,-gl_num*step_riser,0,
			min(standard_x,0)-floor_1-floor_dep+0.001,0,-gl_num*step_riser,
			min(standard_x,0)-floor_1-floor_dep+0.001,step_wid1+handrail_wid+step_wid2,-gl_num*step_riser,
			min(standard_x,0)-floor_1-floor_dep+0.001,step_wid1+handrail_wid+step_wid2,(floor_num-1)*floor_hei+floor_hr_hei,
			min(standard_x,0)-floor_1-floor_dep+0.001,0,(floor_num-1)*floor_hei+floor_hr_hei,
			min(standard_x,0)-floor_1-floor_dep+0.001,0,-gl_num*step_riser

!		endif
	
	endif

endgroup


group "fin_hr_outside2"

	if switch_fin then

		material fin_hr_outside
	
!		if switch_hr1 and hr_hide<>2 then

			ruledsegmented 5,1+2+4+16+32,
			min(standard_x,0)-floor_1-floor_dep,0,-gl_num*step_riser,0,
			(step_num_down-1)*step_tread+landing_1+landing_dep,0,-gl_num*step_riser,0,
			(step_num_down-1)*step_tread+landing_1+landing_dep,0,(floor_num-1)*floor_hei+floor_hr_hei,0,
			min(standard_x,0)-floor_1-floor_dep,0,(floor_num-1)*floor_hei+floor_hr_hei,0,
			min(standard_x,0)-floor_1-floor_dep,0,-gl_num*step_riser,0,
			min(standard_x,0)-floor_1-floor_dep,0.001,-gl_num*step_riser,
			(step_num_down-1)*step_tread+landing_1+landing_dep,0.001,-gl_num*step_riser,
			(step_num_down-1)*step_tread+landing_1+landing_dep,0.001,(floor_num-1)*floor_hei+floor_hr_hei,
			min(standard_x,0)-floor_1-floor_dep,0.001,(floor_num-1)*floor_hei+floor_hr_hei,
			min(standard_x,0)-floor_1-floor_dep,0.001,-gl_num*step_riser

!		endif
	
	endif

endgroup


group "fin_hr_outside3"

	if switch_fin then

		material fin_hr_outside
	
!		if switch_hr1 and hr_hide<>3 then

			ruledsegmented 5,1+2+4+16+32,
			min(standard_x,0)-floor_1-floor_dep,step_wid1+handrail_wid+step_wid2,-gl_num*step_riser,0,
			(step_num_down-1)*step_tread+landing_1+landing_dep,step_wid1+handrail_wid+step_wid2,-gl_num*step_riser,0,
			(step_num_down-1)*step_tread+landing_1+landing_dep,step_wid1+handrail_wid+step_wid2,(floor_num-1)*floor_hei+floor_hr_hei,0,
			min(standard_x,0)-floor_1-floor_dep,step_wid1+handrail_wid+step_wid2,(floor_num-1)*floor_hei+floor_hr_hei,0,
			min(standard_x,0)-floor_1-floor_dep,step_wid1+handrail_wid+step_wid2,-gl_num*step_riser,0,
			min(standard_x,0)-floor_1-floor_dep,step_wid1+handrail_wid+step_wid2-0.001,-gl_num*step_riser,
			(step_num_down-1)*step_tread+landing_1+landing_dep,step_wid1+handrail_wid+step_wid2-0.001,-gl_num*step_riser,
			(step_num_down-1)*step_tread+landing_1+landing_dep,step_wid1+handrail_wid+step_wid2-0.001,(floor_num-1)*floor_hei+floor_hr_hei,
			min(standard_x,0)-floor_1-floor_dep,step_wid1+handrail_wid+step_wid2-0.001,(floor_num-1)*floor_hei+floor_hr_hei,
			min(standard_x,0)-floor_1-floor_dep,step_wid1+handrail_wid+step_wid2-0.001,-gl_num*step_riser

!		endif
	
	endif

endgroup


group "fin_hr_outside4"

	if switch_fin then

		material fin_hr_outside
	
!		if switch_hr1 then

			ruledsegmented 5,1+2+4+16+32,
			(step_num_down-1)*step_tread+landing_1+landing_dep,0,-gl_num*step_riser,0,
			(step_num_down-1)*step_tread+landing_1+landing_dep,step_wid1+handrail_wid+step_wid2,-gl_num*step_riser,0,
			(step_num_down-1)*step_tread+landing_1+landing_dep,step_wid1+handrail_wid+step_wid2,(floor_num-1)*floor_hei+floor_hr_hei,0,
			(step_num_down-1)*step_tread+landing_1+landing_dep,0,(floor_num-1)*floor_hei+floor_hr_hei,0,
			(step_num_down-1)*step_tread+landing_1+landing_dep,0,-gl_num*step_riser,0,
			(step_num_down-1)*step_tread+landing_1+landing_dep-0.001,0,-gl_num*step_riser,
			(step_num_down-1)*step_tread+landing_1+landing_dep-0.001,step_wid1+handrail_wid+step_wid2,-gl_num*step_riser,
			(step_num_down-1)*step_tread+landing_1+landing_dep-0.001,step_wid1+handrail_wid+step_wid2,(floor_num-1)*floor_hei+floor_hr_hei,
			(step_num_down-1)*step_tread+landing_1+landing_dep-0.001,0,(floor_num-1)*floor_hei+floor_hr_hei,
			(step_num_down-1)*step_tread+landing_1+landing_dep-0.001,0,-gl_num*step_riser

!		endif
	
	endif

endgroup


group "fin_hr_outside"
	addx -0.001
	placegroup isectgroup{3}("fin_hr_outside1","step_body",fin_hr_outside,fin_hr_outside,fin_hr_outside)
	del 1

	addy -0.001
	placegroup isectgroup{3}("fin_hr_outside2","step_body",fin_hr_outside,fin_hr_outside,fin_hr_outside)
	del 1

	addy 0.001
	placegroup isectgroup{3}("fin_hr_outside3","step_body",fin_hr_outside,fin_hr_outside,fin_hr_outside)
	del 1

	addx 0.001
	placegroup isectgroup{3}("fin_hr_outside4","step_body",fin_hr_outside,fin_hr_outside,fin_hr_outside)
	del 1
endgroup

fin_hr_outside_1=subgroup{2}("fin_hr_outside","handrail_hide2",m_step,m_step,m_step)
fin_hr_outside_2=subgroup(fin_hr_outside_1,"boarder")


!======================================================================内側立上り内側
group "fin_hr2_inside1"
	if switch_fin then
		material fin_hr_inside
	
		if switch_hr2 then

			if hr2_type=1 then

				ruledsegmented 5,1+2+4+16+32,
				min(standard_x,0)-floor_1-hr2_wid,step_wid1-hr_wid,-gl_num*step_riser,0,
				min(standard_x,0)-floor_1-hr2_wid,step_wid1+handrail_wid+hr_wid,-gl_num*step_riser,0,
				min(standard_x,0)-floor_1-hr2_wid,step_wid1+handrail_wid+hr_wid,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),0,
				min(standard_x,0)-floor_1-hr2_wid,step_wid1-hr_wid,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),0,
				min(standard_x,0)-floor_1-hr2_wid,step_wid1-hr_wid,-gl_num*step_riser,0,
				min(standard_x,0)-floor_1-hr2_wid+0.001,step_wid1-hr_wid,-gl_num*step_riser,
				min(standard_x,0)-floor_1-hr2_wid+0.001,step_wid1+handrail_wid+hr_wid,-gl_num*step_riser,
				min(standard_x,0)-floor_1-hr2_wid+0.001,step_wid1+handrail_wid+hr_wid,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),
				min(standard_x,0)-floor_1-hr2_wid+0.001,step_wid1-hr_wid,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),
				min(standard_x,0)-floor_1-hr2_wid+0.001,step_wid1-hr_wid,-gl_num*step_riser

			else
			
				ruledsegmented 5,1+2+4+16+32,
				min(standard_x,0)-floor_1,step_wid1,-gl_num*step_riser,0,
				min(standard_x,0)-floor_1,step_wid1+handrail_wid,-gl_num*step_riser,0,
				min(standard_x,0)-floor_1,step_wid1+handrail_wid,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),0,
				min(standard_x,0)-floor_1,step_wid1,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),0,
				min(standard_x,0)-floor_1,step_wid1,-gl_num*step_riser,0,
				min(standard_x,0)-floor_1+0.001,step_wid1,-gl_num*step_riser,
				min(standard_x,0)-floor_1+0.001,step_wid1+handrail_wid,-gl_num*step_riser,
				min(standard_x,0)-floor_1+0.001,step_wid1+handrail_wid,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),
				min(standard_x,0)-floor_1+0.001,step_wid1,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),
				min(standard_x,0)-floor_1+0.001,step_wid1,-gl_num*step_riser

			endif

		endif
	endif
endgroup


group "fin_hr2_inside2"
	if switch_fin then
		material fin_hr_inside
	
		if switch_hr2 then

			if hr2_type=1 then

				ruledsegmented 5,1+2+4+16+32,
				min(standard_x,0)-floor_1-hr_wid,step_wid1-hr2_wid,-gl_num*step_riser,0,
				(step_num_down-1)*step_tread+landing_1+hr_wid,step_wid1-hr2_wid,-gl_num*step_riser,0,
				(step_num_down-1)*step_tread+landing_1+hr_wid,step_wid1-hr2_wid,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),0,
				min(standard_x,0)-floor_1-hr_wid,step_wid1-hr2_wid,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),0,
				min(standard_x,0)-floor_1-hr_wid,step_wid1-hr2_wid,-gl_num*step_riser,0,
				min(standard_x,0)-floor_1-hr_wid,step_wid1-hr2_wid+0.001,-gl_num*step_riser,
				(step_num_down-1)*step_tread+landing_1+hr_wid,step_wid1-hr2_wid+0.001,-gl_num*step_riser,
				(step_num_down-1)*step_tread+landing_1+hr_wid,step_wid1-hr2_wid+0.001,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),
				min(standard_x,0)-floor_1-hr_wid,step_wid1-hr2_wid+0.001,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),
				min(standard_x,0)-floor_1-hr_wid,step_wid1-hr2_wid+0.001,-gl_num*step_riser

			else
			
				ruledsegmented 5,1+2+4+16+32,
				min(standard_x,0)-floor_1,step_wid1,-gl_num*step_riser,0,
				(step_num_down-1)*step_tread+landing_1,step_wid1,-gl_num*step_riser,0,
				(step_num_down-1)*step_tread+landing_1,step_wid1,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),0,
				min(standard_x,0)-floor_1,step_wid1,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),0,
				min(standard_x,0)-floor_1,step_wid1,-gl_num*step_riser,0,
				min(standard_x,0)-floor_1,step_wid1+0.001,-gl_num*step_riser,
				(step_num_down-1)*step_tread+landing_1,step_wid1+0.001,-gl_num*step_riser,
				(step_num_down-1)*step_tread+landing_1,step_wid1+0.001,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),
				min(standard_x,0)-floor_1,step_wid1+0.001,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),
				min(standard_x,0)-floor_1,step_wid1+0.001,-gl_num*step_riser

			endif

		endif
	endif
endgroup


group "fin_hr2_inside3"
	if switch_fin then
		material fin_hr_inside
	
		if switch_hr2 then

			if hr2_type=1 then

				ruledsegmented 5,1+2+4+16+32,
				min(standard_x,0)-floor_1-hr_wid,step_wid1+handrail_wid+hr2_wid,-gl_num*step_riser,0,
				(step_num_down-1)*step_tread+landing_1+hr_wid,step_wid1+handrail_wid+hr2_wid,-gl_num*step_riser,0,
				(step_num_down-1)*step_tread+landing_1+hr_wid,step_wid1+handrail_wid+hr2_wid,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),0,
				min(standard_x,0)-floor_1-hr_wid,step_wid1+handrail_wid+hr2_wid,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),0,
				min(standard_x,0)-floor_1-hr_wid,step_wid1+handrail_wid+hr2_wid,-gl_num*step_riser,0,
				min(standard_x,0)-floor_1-hr_wid,step_wid1+handrail_wid+hr2_wid-0.001,-gl_num*step_riser,
				(step_num_down-1)*step_tread+landing_1+hr_wid,step_wid1+handrail_wid+hr2_wid-0.001,-gl_num*step_riser,
				(step_num_down-1)*step_tread+landing_1+hr_wid,step_wid1+handrail_wid+hr2_wid-0.001,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),
				min(standard_x,0)- floor_1-hr_wid,step_wid1+handrail_wid+hr2_wid-0.001,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),
				min(standard_x,0)-floor_1-hr_wid ,step_wid1+handrail_wid+hr2_wid-0.001,-gl_num*step_riser

			else
			
				ruledsegmented 5,1+2+4+16+32,
				min(standard_x,0)-floor_1-hr_wid,step_wid1+handrail_wid,-gl_num*step_riser,0,
				(step_num_down-1)*step_tread+landing_1,step_wid1+handrail_wid,-gl_num*step_riser,0,
				(step_num_down-1)*step_tread+landing_1,step_wid1+handrail_wid,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),0,
				min(standard_x,0)-floor_1-hr_wid,step_wid1+handrail_wid,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),0,
				min(standard_x,0)-floor_1-hr_wid,step_wid1+handrail_wid,-gl_num*step_riser,0,
				min(standard_x,0)-floor_1-hr_wid,step_wid1+handrail_wid-0.001,-gl_num*step_riser,
				(step_num_down-1)*step_tread+landing_1,step_wid1+handrail_wid-0.001,-gl_num*step_riser,
				(step_num_down-1)*step_tread+landing_1,step_wid1+handrail_wid-0.001,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),
				min(standard_x,0)-floor_1-hr_wid,step_wid1+handrail_wid-0.001,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),
				min(standard_x,0)-floor_1-hr_wid,step_wid1+handrail_wid-0.001,-gl_num*step_riser

			endif

		endif
	endif
endgroup


group "fin_hr2_inside4"
	if switch_fin then
		material fin_hr_inside
	
		if switch_hr2 then

			if hr2_type=1 then

				ruledsegmented 5,1+2+4+16+32,
				(step_num_down-1)*step_tread+landing_1+hr2_wid,step_wid1-hr_wid,-gl_num*step_riser,0,
				(step_num_down-1)*step_tread+landing_1+hr2_wid,step_wid1+handrail_wid+hr_wid,-gl_num*step_riser,0,
				(step_num_down-1)*step_tread+landing_1+hr2_wid,step_wid1+handrail_wid+hr_wid,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),0,
				(step_num_down-1)*step_tread+landing_1+hr2_wid,step_wid1-hr_wid,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),0,
				(step_num_down-1)*step_tread+landing_1+hr2_wid,step_wid1-hr_wid,-gl_num*step_riser,0,
				(step_num_down-1)*step_tread+landing_1+hr2_wid-0.001,step_wid1-hr_wid,-gl_num*step_riser,
				(step_num_down-1)*step_tread+landing_1+hr2_wid-0.001,step_wid1+handrail_wid+hr_wid,-gl_num*step_riser,
				(step_num_down-1)*step_tread+landing_1+hr2_wid-0.001,step_wid1+handrail_wid+hr_wid,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),
				(step_num_down-1)*step_tread+landing_1+hr2_wid-0.001,step_wid1-hr_wid,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),
				(step_num_down-1)*step_tread+landing_1+hr2_wid-0.001,step_wid1-hr_wid,-gl_num*step_riser

			else
			
				ruledsegmented 5,1+2+4+16+32,
				(step_num_down-1)*step_tread+landing_1,step_wid1,-gl_num*step_riser,0,
				(step_num_down-1)*step_tread+landing_1,step_wid1+handrail_wid,-gl_num*step_riser,0,
				(step_num_down-1)*step_tread+landing_1,step_wid1+handrail_wid,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),0,
				(step_num_down-1)*step_tread+landing_1,step_wid1,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),0,
				(step_num_down-1)*step_tread+landing_1,step_wid1,-gl_num*step_riser,0,
				(step_num_down-1)*step_tread+landing_1-0.001,step_wid1,-gl_num*step_riser,
				(step_num_down-1)*step_tread+landing_1-0.001,step_wid1+handrail_wid,-gl_num*step_riser,
				(step_num_down-1)*step_tread+landing_1-0.001,step_wid1+handrail_wid,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),
				(step_num_down-1)*step_tread+landing_1-0.001,step_wid1,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),
				(step_num_down-1)*step_tread+landing_1-0.001,step_wid1,-gl_num*step_riser

			endif

		endif
	endif
endgroup


group "fin_hr2_inside"
	addx -0.001
	placegroup isectgroup{2}("fin_hr2_inside1","handrail_uchi",fin_hr_inside,fin_hr_inside,fin_hr_inside)
	del 1

	addy -0.001
	placegroup isectgroup{2}("fin_hr2_inside2","handrail_uchi",fin_hr_inside,fin_hr_inside,fin_hr_inside)
	del 1

	addy 0.001
	placegroup isectgroup{2}("fin_hr2_inside3","handrail_uchi",fin_hr_inside,fin_hr_inside,fin_hr_inside)
	del 1

	addx 0.001
	placegroup isectgroup{2}("fin_hr2_inside4","handrail_uchi",fin_hr_inside,fin_hr_inside,fin_hr_inside)
	del 1

	if switch_gl and switch_hr2 then
		add standard_x+gl_num*step_tread,step_wid1+handrail_wid,-gl_num*step_riser
			block 0.001,hr2_wid,hr2_hei
		del 1
	endif
endgroup


fin_hr2_inside_2=subgroup("fin_hr2_inside","step_body2")
fin_hr2_inside_3=subgroup(fin_hr2_inside_2,"hide_floor_landing2")


!======================================================================内側立上り外側
group "fin_hr2_outside1"

	if switch_fin then

		material fin_hr_outside
	
		if switch_hr2 and hr2_type=1 then

			ruledsegmented 5,1+2+4+16+32,
			min(standard_x,0)-floor_1,step_wid1,-gl_num*step_riser,0,
			min(standard_x,0)-floor_1,step_wid1+handrail_wid,-gl_num*step_riser,0,
			min(standard_x,0)-floor_1,step_wid1+handrail_wid,(floor_num-1)*floor_hei-floor_thi,0,
			min(standard_x,0)-floor_1,step_wid1,(floor_num-1)*floor_hei-floor_thi,0,
			min(standard_x,0)-floor_1,step_wid1,-gl_num*step_riser,0,
			min(standard_x,0)-floor_1-0.001,step_wid1,-gl_num*step_riser,
			min(standard_x,0)-floor_1-0.001,step_wid1+handrail_wid,-gl_num*step_riser,
			min(standard_x,0)-floor_1-0.001,step_wid1+handrail_wid,(floor_num-1)*floor_hei-floor_thi,
			min(standard_x,0)-floor_1-0.001,step_wid1,(floor_num-1)*floor_hei-floor_thi,
			min(standard_x,0)-floor_1-0.001,step_wid1,-gl_num*step_riser

		endif
	
	endif

endgroup


group "fin_hr2_outside2"

	if switch_fin then

		material fin_hr_outside
	
		if switch_hr2 and hr2_type=1 then

			ruledsegmented 5,1+2+4+16+32,
			min(standard_x,0)-floor_1-hr_wid,step_wid1,-gl_num*step_riser,0,
			step_num_down*step_tread+landing_1+hr_wid,step_wid1,-gl_num*step_riser,0,
			step_num_down*step_tread+landing_1+hr_wid,step_wid1,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),0,
			min(standard_x,0)-floor_1-hr_wid,step_wid1,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),0,
			min(standard_x,0)-floor_1-hr_wid,step_wid1,-gl_num*step_riser,0,
			min(standard_x,0)-floor_1-hr_wid,step_wid1-0.001,-gl_num*step_riser,
			step_num_down*step_tread+landing_1+hr_wid,step_wid1-0.001,-gl_num*step_riser,
			step_num_down*step_tread+landing_1+hr_wid,step_wid1-0.001,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),
			min(standard_x,0)-floor_1-hr_wid,step_wid1-0.001,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),
			min(standard_x,0)-floor_1-hr_wid,step_wid1-0.001,-gl_num*step_riser

		endif
	
	endif

endgroup


group "fin_hr2_outside3"

	if switch_fin then

		material fin_hr_outside
	
		if switch_hr2 and hr2_type=1 then

			ruledsegmented 5,1+2+4+16+32,
			min(standard_x,0)-floor_1-hr_wid,step_wid1+handrail_wid,-gl_num*step_riser,0,
			step_num_down*step_tread+landing_1+hr_wid,step_wid1+handrail_wid,-gl_num*step_riser,0,
			step_num_down*step_tread+landing_1+hr_wid,step_wid1+handrail_wid,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),0,
			min(standard_x,0)-floor_1-hr_wid,step_wid1+handrail_wid,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),0,
			min(standard_x,0)-floor_1-hr_wid,step_wid1+handrail_wid,-gl_num*step_riser,0,
			min(standard_x,0)-floor_1-hr_wid,step_wid1+handrail_wid+0.001,-gl_num*step_riser,
			step_num_down*step_tread+landing_1+hr_wid,step_wid1+handrail_wid+0.001,-gl_num*step_riser,
			step_num_down*step_tread+landing_1+hr_wid,step_wid1+handrail_wid+0.001,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),
			min(standard_x,0)-floor_1-hr_wid,step_wid1+handrail_wid+0.001,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),
			min(standard_x,0)-floor_1-hr_wid,step_wid1+handrail_wid+0.001,-gl_num*step_riser

		endif
	
	endif

endgroup


group "fin_hr2_outside4"

	if switch_fin then

		material fin_hr_outside
	
		if switch_hr2 and hr2_type=1 then

			ruledsegmented 5,1+2+4+16+32,
			(step_num_down-1)*step_tread+landing_1,step_wid1,-gl_num*step_riser,0,
			(step_num_down-1)*step_tread+landing_1,step_wid1+handrail_wid,-gl_num*step_riser,0,
			(step_num_down-1)*step_tread+landing_1,step_wid1+handrail_wid,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),0,
			(step_num_down-1)*step_tread+landing_1,step_wid1,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),0,
			(step_num_down-1)*step_tread+landing_1,step_wid1,-gl_num*step_riser,0,
			(step_num_down-1)*step_tread+landing_1+0.001,step_wid1,-gl_num*step_riser,
			(step_num_down-1)*step_tread+landing_1+0.001,step_wid1+handrail_wid,-gl_num*step_riser,
			(step_num_down-1)*step_tread+landing_1+0.001,step_wid1+handrail_wid,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),
			(step_num_down-1)*step_tread+landing_1+0.001,step_wid1,(floor_num-1)*floor_hei+max(hr2_hei,max_hr_hei),
			(step_num_down-1)*step_tread+landing_1+0.001,step_wid1,-gl_num*step_riser

		endif
	
	endif

endgroup


group "fin_hr2_outside"

	addx 0.001
	placegroup isectgroup{2}("fin_hr2_outside1","step_body2",fin_hr_outside,fin_hr_outside,fin_hr_outside)
	del 1

	addy 0.001
	placegroup isectgroup{2}("fin_hr2_outside2","step_body2",fin_hr_outside,fin_hr_outside,fin_hr_outside)
	del 1

	addy -0.001
	placegroup isectgroup{2}("fin_hr2_outside3","step_body2",fin_hr_outside,fin_hr_outside,fin_hr_outside)
	del 1

	addx -0.001
	placegroup isectgroup{2}("fin_hr2_outside4","step_body2",fin_hr_outside,fin_hr_outside,fin_hr_outside)
	del 1

endgroup


fin_hr2_outside_2=subgroup("fin_hr2_outside","step_body2")
fin_hr2_outside_3=subgroup(fin_hr2_outside_2,"hide_floor_landing")
fin_hr2_outside_4=subgroup(fin_hr2_outside_3,"hide_floor_landing3")


if switch_fin then
	placegroup fin_step_2
	placegroup fin_landing_4
	placegroup fin_ditch_5
	placegroup "fin_hr_top2"

	if switch_hr1 then
		placegroup fin_hr_inside_10
		placegroup fin_hr_outside_2
	endif

	placegroup fin_hr2_inside_3
	placegroup fin_hr2_outside_4
endif




























if step_dir=2 then del 1
if switch_turn then del 1






